(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* Created By: SaveReadableNotebook *)
(* https://resources.wolframcloud.com/FunctionRepository/resources/SaveReadableNotebook *)

Notebook[
 {
  Cell[
   BoxData[
    {
     RowBox[{RowBox[{"numKernels", "=", "8"}], ";"}],
     "\[IndentingNewLine]",
     RowBox[
      {
       RowBox[{"Unprotect", "[", "$ProcessorCount", "]"}],
       ";",
       RowBox[{"$ProcessorCount", "=", "numKernels"}],
       ";"
      }
     ],
     "\[IndentingNewLine]",
     RowBox[
      {
       RowBox[{"CloseKernels", "[", "]"}],
       ";",
       RowBox[{"LaunchKernels", "[", "numKernels", "]"}],
       ";",
       RowBox[{"ParallelKernels", "[", "]"}],
       ";"
      }
     ]
    }
   ],
   "Input"
  ],
  Cell[
   BoxData[
    RowBox[
     {
      RowBox[
       {
        "(*",
        RowBox[
         {
          RowBox[
           {"test", " ", "parallel", " ", "kernels", " ", "work"}
          ],
          ",",
          RowBox[
           {
            "line",
            " ",
            "with",
            " ",
            "ParallelSum",
            " ",
            "should",
            " ",
            "execute",
            " ",
            "faster",
            " ",
            "than",
            " ",
            "line",
            " ",
            "with",
            " ",
            "Sum"
           }
          ]
         }
        ],
        "*)"
       }
      ],
      "\[IndentingNewLine]",
      RowBox[
       {
        "(*",
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Sum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  RowBox[
                   {
                    "(",
                    RowBox[
                     {
                      "n",
                      "-",
                      RowBox[
                       {
                        "Total",
                        "[",
                        RowBox[
                         {"IntegerDigits", "[", RowBox[{"n", ",", "5"}], "]"}
                        ],
                        "]"
                       }
                      ]
                     }
                    ],
                    ")"
                   }
                  ],
                  "/",
                  "4"
                 }
                ],
                ",",
                RowBox[
                 {
                  "{",
                  RowBox[
                   {
                    "n",
                    ",",
                    RowBox[{"10", "^", "3"}],
                    ",",
                    RowBox[{"10", "^", "7"}]
                   }
                  ],
                  "}"
                 }
                ]
               }
              ],
              "]"
             }
            ],
            "//",
            RowBox[
             {
              "AbsoluteTiming",
              "\n",
              RowBox[
               {
                "ParallelSum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    RowBox[
                     {
                      "(",
                      RowBox[
                       {
                        "n",
                        "-",
                        RowBox[
                         {
                          "Total",
                          "[",
                          RowBox[
                           {"IntegerDigits", "[", RowBox[{"n", ",", "5"}], "]"}
                          ],
                          "]"
                         }
                        ]
                       }
                      ],
                      ")"
                     }
                    ],
                    "/",
                    "4"
                   }
                  ],
                  ",",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {
                      "n",
                      ",",
                      RowBox[{"10", "^", "3"}],
                      ",",
                      RowBox[{"10", "^", "7"}]
                     }
                    ],
                    "}"
                   }
                  ]
                 }
                ],
                "]"
               }
              ]
             }
            ]
           }
          ],
          "//",
          "AbsoluteTiming"
         }
        ],
        "\[IndentingNewLine]",
        "*)"
       }
      ]
     }
    ]
   ],
   "Input"
  ],
  Cell[
   CellGroupData[
    {
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "thisFileName",
            "=",
            RowBox[
             {
              "FileNameJoin",
              "[",
              RowBox[
               {
                "{",
                RowBox[
                 {
                  RowBox[
                   {
                    "DirectoryName",
                    "[",
                    RowBox[{RowBox[{"NotebookDirectory", "[", "]"}], ",", "1"}],
                    "]"
                   }
                  ],
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      "FileBaseName",
                      "[",
                      RowBox[{"NotebookFileName", "[", "]"}],
                      "]"
                     }
                    ],
                    "<>",
                    "\".wlt\""
                   }
                  ]
                 }
                ],
                "}"
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "thisFileBase",
            "=",
            RowBox[{"FileBaseName", "[", "thisFileName", "]"}]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "pacletDir",
            "=",
            RowBox[
             {
              "DirectoryName",
              "[",
              RowBox[{"thisFileName", ",", "1"}],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "resourcesDir",
          "=",
          RowBox[
           {
            "FileNameJoin",
            "[",
            RowBox[
             {"{", RowBox[{"pacletDir", ",", "\"Resources\""}], "}"}
            ],
            "]"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ]
    },
    Open
   ]
  ],
  Cell[
   CellGroupData[
    {
     Cell["Build database", "Subsection"],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          {
           RowBox[
            {
             "Get",
             "@",
             RowBox[
              {
               "Get",
               "[",
               RowBox[
                {
                 "FileNameJoin",
                 "[",
                 RowBox[
                  {"{", RowBox[{"resourcesDir", ",", "\"Models.wl\""}], "}"}
                 ],
                 "]"
                }
               ],
               "]"
              }
             ]
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "(*",
               RowBox[
                {
                 RowBox[
                  {
                   "Get",
                   "@",
                   RowBox[
                    {
                     "FileNameJoin",
                     "[",
                     RowBox[
                      {
                       "{",
                       RowBox[
                        {
                         "pacletDir",
                         ",",
                         "\"Kernel\"",
                         ",",
                         "\"ComputationalEngine\"",
                         ",",
                         RowBox[{"\"CreateMomentsDatabase\"", "<>", "\".wl\""}]
                        }
                       ],
                       "}"
                      }
                     ],
                     "]"
                    }
                   ]
                  }
                 ],
                 ";"
                }
               ],
               "*)"
              }
             ]
            }
           ]
          }
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "Needs",
           "[",
           "\"FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`\"",
           "]"
          }
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "ParallelEvaluate",
           "[",
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}],
             ";",
             "\[IndentingNewLine]",
             RowBox[
              {
               "Needs",
               "[",
               "\"FernandoDuarte`LongRunRisk`ComputationalEngine`ComputeUnconditionalExpectations`\"",
               "]"
              }
             ],
             ";",
             RowBox[
              {
               "Needs",
               "[",
               "\"FernandoDuarte`LongRunRisk`ComputationalEngine`ComputeConditionalExpectations`\"",
               "]"
              }
             ],
             ";",
             "\[IndentingNewLine]",
             RowBox[
              {
               "Needs",
               "[",
               "\"FernandoDuarte`LongRunRisk`Model`ExogenousEq`\"",
               "]"
              }
             ],
             ";",
             "\[IndentingNewLine]",
             RowBox[
              {
               "Needs",
               "[",
               "\"FernandoDuarte`LongRunRisk`Model`Shocks`\"",
               "]"
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           "]"
          }
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          {
           RowBox[
            {
             RowBox[
              {"Off", "[", RowBox[{"General", "::", "stop"}], "]"}
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             "AbsoluteTiming",
             "[",
             "\[IndentingNewLine]",
             RowBox[
              {
               RowBox[
                {
                 "Do",
                 "[",
                 "\[IndentingNewLine]",
                 RowBox[
                  {
                   RowBox[
                    {
                     RowBox[
                      {
                       "fileName",
                       "=",
                       RowBox[
                        {
                         "FileNameJoin",
                         "[",
                         RowBox[
                          {
                           "{",
                           RowBox[
                            {
                             "resourcesDir",
                             ",",
                             "\"MomentsLookupTables\"",
                             ",",
                             RowBox[{"\"covLong\"", "<>", "key", "<>", "\".wl\""}]
                            }
                           ],
                           "}"
                          }
                         ],
                         "]"
                        }
                       ]
                      }
                     ],
                     ";",
                     "\[IndentingNewLine]",
                     RowBox[
                      {
                       "If",
                       "[",
                       "\[IndentingNewLine]",
                       RowBox[
                        {
                         RowBox[
                          {"!", RowBox[{"FileExistsQ", "[", "fileName", "]"}]}
                         ],
                         ",",
                         "\[IndentingNewLine]",
                         RowBox[{"CreateFile", "[", "fileName", "]"}]
                        }
                       ],
                       "\[IndentingNewLine]",
                       "]"
                      }
                     ],
                     ";",
                     "\[IndentingNewLine]",
                     RowBox[
                      {
                       "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`createDatabase",
                       "[",
                       "\n",
                       "\t",
                       RowBox[
                        {
                         RowBox[
                          {"FernandoDuarte`LongRunRisk`Models", "[", "key", "]"}
                         ],
                         ",",
                         "\n",
                         "\t",
                         "fileName",
                         ",",
                         "\[IndentingNewLine]",
                         RowBox[{"\"simplifyDownValues\"", " ", "->", " ", "True"}]
                        }
                       ],
                       "\[IndentingNewLine]",
                       "]"
                      }
                     ],
                     ";"
                    }
                   ],
                   "\[IndentingNewLine]",
                   ",",
                   "\[IndentingNewLine]",
                   RowBox[
                    {
                     "{",
                     RowBox[
                      {
                       "key",
                       ",",
                       RowBox[
                        {
                         "{",
                         RowBox[
                          {
                           "(*",
                           RowBox[
                            {"\"BKY\"", ",", "\"NRC\"", ",", "\"NRCStochVol\"", ","}
                           ],
                           "*)"
                          }
                         ],
                         "\"DES\"",
                         "}"
                        }
                       ]
                      }
                     ],
                     RowBox[
                      {
                       "(*",
                       RowBox[{"Keys", "@", "FernandoDuarte`LongRunRisk`Models"}],
                       "*)"
                      }
                     ],
                     "}"
                    }
                   ]
                  }
                 ],
                 "\[IndentingNewLine]",
                 "]"
                }
               ],
               ";"
              }
             ],
             "\[IndentingNewLine]",
             "]"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[{"On", "[", RowBox[{"General", "::", "stop"}], "]"}],
             ";"
            }
           ]
          }
         ],
         "Input"
        ],
        Cell[CellGroupData[{}, Open]]
       },
       Open
      ]
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           RowBox[
            {
             "{",
             RowBox[
              {
               "\"BKY\"",
               ",",
               "\"NRC\"",
               ",",
               "\"NRCStochVol\"",
               ",",
               "\"DES\""
              }
             ],
             "}"
            }
           ],
           " ",
           "time",
           "  ",
           RowBox[{RowBox[{"20707", "/", "60"}], "/", "60"}]
          }
         ],
         "//",
         "N"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "BKYtime",
           "=",
           RowBox[{"{", RowBox[{"4785.605649`", ",", "Null"}], "}"}]
          }
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "NRCStochVoltime",
         "=",
         RowBox[{"{", RowBox[{"345088.066629", ",", "Null"}], "}"}]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           RowBox[{RowBox[{"345088", "/", "60"}], "/", "60"}],
           "/",
           "24"
          }
         ],
         "//",
         "N"
        }
       ]
      ],
      "Input"
     ]
    },
    Open
   ]
  ],
  Cell[
   CellGroupData[
    {
     Cell["Load and test", "Subsection"],
     Cell[
      BoxData[RowBox[{RowBox[{"Quit", "[", "]"}], ";"}]],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "thisFileName",
            "=",
            RowBox[
             {
              "FileNameJoin",
              "[",
              RowBox[
               {
                "{",
                RowBox[
                 {
                  RowBox[
                   {
                    "DirectoryName",
                    "[",
                    RowBox[{RowBox[{"NotebookDirectory", "[", "]"}], ",", "1"}],
                    "]"
                   }
                  ],
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      "FileBaseName",
                      "[",
                      RowBox[{"NotebookFileName", "[", "]"}],
                      "]"
                     }
                    ],
                    "<>",
                    "\".wlt\""
                   }
                  ]
                 }
                ],
                "}"
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "thisFileBase",
            "=",
            RowBox[{"FileBaseName", "[", "thisFileName", "]"}]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "pacletDir",
            "=",
            RowBox[
             {
              "DirectoryName",
              "[",
              RowBox[{"thisFileName", ",", "1"}],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "resourcesDir",
            "=",
            RowBox[
             {
              "FileNameJoin",
              "[",
              RowBox[
               {"{", RowBox[{"pacletDir", ",", "\"Resources\""}], "}"}
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "filenameModels",
            "=",
            RowBox[
             {
              "FileNameJoin",
              "[",
              RowBox[
               {"{", RowBox[{"resourcesDir", ",", "\"Models.wl\""}], "}"}
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "dataModels",
          "=",
          RowBox[{"Get", "[", "filenameModels", "]"}]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[{"Get", "@", "dataModels"}]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "model",
            "=",
            RowBox[
             {
              "FernandoDuarte`LongRunRisk`Models",
              "[",
              "\"NRCStochVol\"",
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "modelShortName",
            "=",
            RowBox[{"model", "[", "\"shortname\"", "]"}]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "covLongFilename",
            "=",
            RowBox[
             {
              "FileNameJoin",
              "[",
              RowBox[
               {
                "{",
                RowBox[
                 {
                  "resourcesDir",
                  ",",
                  "\"MomentsLookupTables\"",
                  ",",
                  RowBox[
                   {"\"covLong\"", "<>", "modelShortName", "<>", "\".wl\""}
                  ]
                 }
                ],
                "}"
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "covLongFilenameSave",
            "=",
            RowBox[
             {
              "FileNameJoin",
              "[",
              RowBox[
               {
                "{",
                RowBox[
                 {
                  "resourcesDir",
                  ",",
                  "\"MomentsLookupTables\"",
                  ",",
                  RowBox[
                   {
                    "\"covLong\"",
                    "<>",
                    "modelShortName",
                    "<>",
                    "\"Save.wl\""
                   }
                  ]
                 }
                ],
                "}"
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "toExogenous",
            " ",
            "=",
            " ",
            RowBox[
             {
              "Normal",
              "@",
              RowBox[{"model", "[", "\"endogenousEq\"", "]"}]
             }
            ]
           }
          ],
          ";"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "dataCovLong",
          "=",
          RowBox[{"Get", "[", "covLongFilename", "]"}]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {"covLong", "=", RowBox[{"Get", "@", "dataCovLong"}]}
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "oldDv",
            "=",
            RowBox[
             {
              "dv",
              "=",
              RowBox[
               {
                "DownValues",
                "[",
                RowBox[{"Evaluate", "@", "covLong"}],
                "]"
               }
              ]
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[{"dv", "[", RowBox[{"[", "1", "]"}], "]"}],
        "\[IndentingNewLine]",
        RowBox[
         {"dv", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "DownValues",
            "[",
            RowBox[{"Evaluate", "@", "covLong"}],
            "]"
           }
          ],
          "[",
          RowBox[{"[", RowBox[{"-", "1"}], "]"}],
          "]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "Keys",
          "@",
          RowBox[
           {
            RowBox[
             {
              "DownValues",
              "[",
              RowBox[{"Evaluate", "@", "covLong"}],
              "]"
             }
            ],
            "[",
            RowBox[{"[", RowBox[{"-", "1"}], "]"}],
            "]"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {RowBox[{"Length", "[", "dv", "]"}], "\[IndentingNewLine]"}
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {"ResourceFunction", "[", "\"ExtractDownValues\"", "]"}
          ],
          "@",
          RowBox[
           {
            "(",
            RowBox[
             {
              RowBox[{"(", RowBox[{"Evaluate", "@", "covLong"}], ")"}],
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "{",
                  RowBox[
                   {
                    "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dd",
                    ",",
                    "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dd"
                   }
                  ],
                  "}"
                 }
                ],
                ",",
                "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`pi",
                ",",
                RowBox[{"-", "1"}],
                ",",
                RowBox[{"-", "1"}],
                ",",
                "j",
                ",",
                "j"
               }
              ],
              "]"
             }
            ],
            ")"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "Timing",
            "[",
            "\[IndentingNewLine]",
            RowBox[
             {
              "covLong",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "{",
                  RowBox[
                   {
                    "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dd",
                    ",",
                    "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dd"
                   }
                  ],
                  "}"
                 }
                ],
                ",",
                "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`pi",
                ",",
                RowBox[{"-", "1"}],
                ",",
                RowBox[{"-", "1"}],
                ",",
                "j",
                ",",
                "j"
               }
              ],
              "]"
             }
            ],
            "\[IndentingNewLine]",
            "]"
           }
          ],
          "\[IndentingNewLine]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "dv",
            "=",
            RowBox[
             {
              "DownValues",
              "[",
              RowBox[{"Evaluate", "@", "covLong"}],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[{"Length", "[", "dv", "]"}]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "Timing",
          "[",
          "\[IndentingNewLine]",
          RowBox[
           {
            "covLong",
            "[",
            RowBox[
             {
              RowBox[
               {
                "{",
                RowBox[
                 {
                  "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dd",
                  ",",
                  "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dd"
                 }
                ],
                "}"
               }
              ],
              ",",
              "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`pi",
              ",",
              RowBox[{"-", "1"}],
              ",",
              RowBox[{"-", "1"}],
              ",",
              "j",
              ",",
              "j"
             }
            ],
            "]"
           }
          ],
          "\[IndentingNewLine]",
          "]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "dv",
            "=",
            RowBox[
             {
              "DownValues",
              "[",
              RowBox[{"Evaluate", "@", "covLong"}],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[{"Length", "[", "dv", "]"}]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "newDv",
         "=",
         RowBox[
          {
           RowBox[
            {"ResourceFunction", "[", "\"ExtractDownValues\"", "]"}
           ],
           "@",
           RowBox[
            {
             "(",
             RowBox[
              {
               RowBox[{"(", RowBox[{"Evaluate", "@", "covLong"}], ")"}],
               "[",
               RowBox[
                {
                 RowBox[
                  {
                   "{",
                   RowBox[
                    {
                     "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dd",
                     ",",
                     "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dd"
                    }
                   ],
                   "}"
                  }
                 ],
                 ",",
                 "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`pi",
                 ",",
                 RowBox[{"-", "1"}],
                 ",",
                 RowBox[{"-", "1"}],
                 ",",
                 "j",
                 ",",
                 "j"
                }
               ],
               "]"
              }
             ],
             ")"
            }
           ]
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[{"Length", "[", "newDv", "]"}],
        "\[IndentingNewLine]",
        RowBox[{"newDv", "[", RowBox[{"[", "1", "]"}], "]"}]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "posNew",
          "=",
          RowBox[
           {
            "Position",
            "[",
            RowBox[
             {
              "dv",
              ",",
              RowBox[
               {
                "Verbatim",
                "[",
                RowBox[
                 {
                  "Evaluate",
                  "@",
                  RowBox[{"newDv", "[", RowBox[{"[", "1", "]"}], "]"}]
                 }
                ],
                "]"
               }
              ]
             }
            ],
            "]"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {"Extract", "[", RowBox[{"dv", ",", "posNew"}], "]"}
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[{"kold", "=", RowBox[{"Keys", "@", "oldDv"}]}],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {RowBox[{"knew", "=", RowBox[{"Keys", "@", "dv"}]}], ";"}
        ],
        "\[IndentingNewLine]",
        RowBox[{"Length", "@", "kold"}],
        "\[IndentingNewLine]",
        RowBox[{"Length", "@", "knew"}],
        "\[IndentingNewLine]",
        RowBox[
         {
          "co1",
          "=",
          RowBox[
           {"Complement", "[", RowBox[{"knew", ",", "kold"}], "]"}
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "co2",
          "=",
          RowBox[
           {"Complement", "[", RowBox[{"kold", ",", "knew"}], "]"}
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "posNew",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "Position",
                "[",
                RowBox[{"dv", ",", RowBox[{"Verbatim", "[", "#", "]"}]}],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "co1"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "Extract",
          "[",
          RowBox[
           {
            "dv",
            ",",
            RowBox[
             {
              "posNew",
              " ",
              "[",
              RowBox[{"[", RowBox[{";;", ",", ";;", ",", "1"}], "]"}],
              "]"
             }
            ]
           }
          ],
          "]"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "(*",
         RowBox[
          {
           RowBox[
            {
             "pis",
             "=",
             RowBox[
              {
               "Sum",
               "[",
               RowBox[
                {
                 RowBox[
                  {
                   "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dc",
                   "[",
                   RowBox[{"t", "+", "j"}],
                   "]"
                  }
                 ],
                 ",",
                 RowBox[{"{", RowBox[{"j", ",", "0", ",", "12"}], "}"}]
                }
               ],
               "]"
              }
             ]
            }
           ],
           ";",
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               RowBox[
                {
                 RowBox[{"uncondVar", "[", "pis", "]"}],
                 "//.",
                 RowBox[
                  {
                   RowBox[{"model", "[", "\"params\"", "]"}],
                   "\[IndentingNewLine]",
                   RowBox[
                    {
                     "Timing",
                     "[",
                     RowBox[
                      {
                       "uncondVarLong",
                       "[",
                       RowBox[
                        {
                         "pis",
                         ",",
                         "FernandoDuarte`LongRunRisk`covLongNRCStochVol"
                        }
                       ],
                       "]"
                      }
                     ],
                     "]"
                    }
                   ]
                  }
                 ]
                }
               ],
               "//.",
               RowBox[
                {
                 RowBox[{"model", "[", "\"params\"", "]"}],
                 "\[IndentingNewLine]",
                 RowBox[
                  {
                   "Timing",
                   "[",
                   RowBox[{"uncondVar", "[", "pis", "]"}],
                   "]"
                  }
                 ]
                }
               ]
              }
             ],
             "//.",
             RowBox[
              {
               RowBox[{"model", "[", "\"params\"", "]"}],
               "\[IndentingNewLine]",
               RowBox[
                {
                 "uncondVarLong",
                 "[",
                 RowBox[
                  {
                   "pis",
                   ",",
                   "FernandoDuarte`LongRunRisk`covLongNRCStochVol"
                  }
                 ],
                 "]"
                }
               ]
              }
             ]
            }
           ],
           ";"
          }
         ],
         "*)"
        }
       ]
      ],
      "Input"
     ]
    },
    Open
   ]
  ],
  Cell[
   CellGroupData[
    {
     Cell["DES seq", "Section"],
     Cell[
      BoxData[RowBox[{RowBox[{"Quit", "[", "]"}], ";"}]],
      "Input"
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          {
           RowBox[
            {
             RowBox[
              {
               "Quiet",
               "[",
               RowBox[
                {
                 "PacletUninstall",
                 "[",
                 "\"FernandoDuarte/LongRunRisk\"",
                 "]"
                }
               ],
               "]"
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "thisFileName",
               "=",
               RowBox[
                {
                 "FileNameJoin",
                 "[",
                 RowBox[
                  {
                   "{",
                   RowBox[
                    {
                     RowBox[
                      {
                       "DirectoryName",
                       "[",
                       RowBox[{RowBox[{"NotebookDirectory", "[", "]"}], ",", "1"}],
                       "]"
                      }
                     ],
                     ",",
                     RowBox[
                      {
                       RowBox[
                        {
                         "FileBaseName",
                         "[",
                         RowBox[{"NotebookFileName", "[", "]"}],
                         "]"
                        }
                       ],
                       "<>",
                       "\".wlt\""
                      }
                     ]
                    }
                   ],
                   "}"
                  }
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "thisFileBase",
               "=",
               RowBox[{"FileBaseName", "[", "thisFileName", "]"}]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "pacletDir",
               "=",
               RowBox[
                {
                 "DirectoryName",
                 "[",
                 RowBox[{"thisFileName", ",", "1"}],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "resourcesDir",
               "=",
               RowBox[
                {
                 "FileNameJoin",
                 "[",
                 RowBox[
                  {"{", RowBox[{"pacletDir", ",", "\"Resources\""}], "}"}
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "filenameModels",
               "=",
               RowBox[
                {
                 "FileNameJoin",
                 "[",
                 RowBox[
                  {"{", RowBox[{"resourcesDir", ",", "\"Models.wl\""}], "}"}
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             "dataModels",
             "=",
             RowBox[{"Get", "[", "filenameModels", "]"}]
            }
           ],
           "\[IndentingNewLine]",
           RowBox[{"Get", "@", "dataModels"}],
           "\[IndentingNewLine]",
           "$ContextPath"
          }
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          {
           RowBox[
            {
             RowBox[
              {
               "Needs",
               "[",
               "\"FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`\"",
               "]"
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             "$ContextPath",
             " ",
             "=",
             " ",
             RowBox[
              {
               "Append",
               "[",
               RowBox[
                {
                 "$ContextPath",
                 ",",
                 "\"FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`Private`\""
                }
               ],
               "]"
              }
             ]
            }
           ]
          }
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "model",
            "=",
            RowBox[
             {"FernandoDuarte`LongRunRisk`Models", "[", "\"DES\"", "]"}
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "modelShortName",
            "=",
            RowBox[{"model", "[", "\"shortname\"", "]"}]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "covLongFilename",
            "=",
            RowBox[
             {
              "FileNameJoin",
              "[",
              RowBox[
               {
                "{",
                RowBox[
                 {
                  "resourcesDir",
                  ",",
                  "\"MomentsLookupTables\"",
                  ",",
                  RowBox[
                   {"\"covLong\"", "<>", "modelShortName", "<>", "\".wl\""}
                  ]
                 }
                ],
                "}"
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "opts",
            " ",
            "=",
            " ",
            RowBox[
             {
              "Flatten",
              "@",
              RowBox[
               {
                "{",
                RowBox[
                 {
                  RowBox[
                   {
                    "Options",
                    "[",
                    "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`createDatabase",
                    "]"
                   }
                  ],
                  ",",
                  RowBox[
                   {
                    "Options",
                    "[",
                    "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`uncondCovLongExo",
                    "]"
                   }
                  ]
                 }
                ],
                "}"
               }
              ]
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "covLong",
            " ",
            "=",
            " ",
            RowBox[
             {
              "Symbol",
              "[",
              RowBox[
               {
                "\"FernandoDuarte`LongRunRisk`covLong\"",
                " ",
                "<>",
                " ",
                RowBox[{"model", "[", "\"shortname\"", "]"}]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "toExogenous",
            " ",
            "=",
            " ",
            RowBox[
             {
              "Normal",
              " ",
              "@",
              " ",
              RowBox[{"model", "[", "\"endogenousEq\"", "]"}]
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "maxLag",
            " ",
            "=",
            " ",
            RowBox[{"\"maxMomentsLagsToCreate\"", "/.", "opts"}]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "seqStart",
            " ",
            "=",
            " ",
            RowBox[{"\"startSequenceAtLag\"", "/.", "opts"}]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "t",
            " ",
            "=",
            " ",
            "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`t"
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "uncondCovLongExoOpts",
              " ",
              "=",
              " ",
              RowBox[
               {
                "FilterRules",
                "[",
                RowBox[
                 {
                  RowBox[{"Flatten", "[", RowBox[{"{", "opts", "}"}], "]"}],
                  ",",
                  RowBox[
                   {
                    "Options",
                    "[",
                    "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`uncondCovLongExo",
                    "]"
                   }
                  ]
                 }
                ],
                "]"
               }
              ]
             }
            ],
            ";"
           }
          ],
          "\[IndentingNewLine]",
          RowBox[{"(*", RowBox[{"load", " ", "packages"}], "*)"}]
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "Needs",
            "[",
            "\"FernandoDuarte`LongRunRisk`ComputationalEngine`ComputeUnconditionalExpectations`\"",
            "]"
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Needs",
              "[",
              "\"FernandoDuarte`LongRunRisk`ComputationalEngine`ComputeConditionalExpectations`\"",
              "]"
             }
            ],
            ";"
           }
          ],
          "\[IndentingNewLine]",
          RowBox[
           {
            "(*",
            RowBox[
             {
              RowBox[
               {
                "Needs",
                "[",
                "\"FernandoDuarte`LongRunRisk`Model`Parameters`\"",
                "]"
               }
              ],
              ";"
             }
            ],
            "*)"
           }
          ]
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "Needs",
            "[",
            "\"FernandoDuarte`LongRunRisk`Model`ExogenousEq`\"",
            "]"
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "Needs",
            "[",
            "\"FernandoDuarte`LongRunRisk`Model`Shocks`\"",
            "]"
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "ParallelEvaluate",
            "[",
            "\[IndentingNewLine]",
            RowBox[
             {
              RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}],
              ";",
              "\[IndentingNewLine]",
              RowBox[
               {
                "Needs",
                "[",
                "\"FernandoDuarte`LongRunRisk`ComputationalEngine`ComputeUnconditionalExpectations`\"",
                "]"
               }
              ],
              ";",
              RowBox[
               {
                "Needs",
                "[",
                "\"FernandoDuarte`LongRunRisk`ComputationalEngine`ComputeConditionalExpectations`\"",
                "]"
               }
              ],
              ";",
              "\[IndentingNewLine]",
              RowBox[
               {
                "Needs",
                "[",
                "\"FernandoDuarte`LongRunRisk`Model`ExogenousEq`\"",
                "]"
               }
              ],
              ";",
              "\[IndentingNewLine]",
              RowBox[
               {
                "Needs",
                "[",
                "\"FernandoDuarte`LongRunRisk`Model`Shocks`\"",
                "]"
               }
              ],
              ";"
             }
            ],
            "\[IndentingNewLine]",
            "]"
           }
          ],
          ";"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      CellGroupData[
       {Cell[BoxData["$ContextPath"], "Input"]},
       Open
      ]
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[{RowBox[{"ind1", "=", "1"}], ";"}],
          RowBox[
           {
            "(*",
            RowBox[
             {
              "{",
              RowBox[
               {"ind1", ",", " ", RowBox[{"Length", "[", "exo", "]"}]}
              ],
              "}"
             }
            ],
            "*)"
           }
          ]
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[{RowBox[{"ind2", "=", "1"}], ";"}],
          RowBox[
           {
            "(*",
            RowBox[{"{", RowBox[{"ind2", ",", " ", "ind1"}], "}"}],
            "*)"
           }
          ],
          "\n"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "v1",
            "=",
            RowBox[
             {
              "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`Private`exo",
              "[",
              RowBox[{"[", "ind1", "]"}],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "v2",
            "=",
            RowBox[
             {
              "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`Private`exo",
              "[",
              RowBox[{"[", "ind2", "]"}],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "tempNeg",
            " ",
            "=",
            " ",
            RowBox[
             {
              "Table",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "{",
                  RowBox[
                   {
                    "T",
                    ",",
                    " ",
                    RowBox[
                     {
                      "uncondCov",
                      "[",
                      RowBox[
                       {
                        RowBox[{"v1", "[", "t", "]"}],
                        ",",
                        " ",
                        RowBox[{"v2", "[", RowBox[{"t", " ", "+", " ", "T"}], "]"}],
                        ",",
                        " ",
                        "model"
                       }
                      ],
                      "]"
                     }
                    ]
                   }
                  ],
                  "}"
                 }
                ],
                ",",
                " ",
                RowBox[
                 {
                  "{",
                  RowBox[
                   {
                    "T",
                    ",",
                    " ",
                    RowBox[{RowBox[{"-", "maxLag"}], " ", "-", " ", "1"}],
                    ",",
                    " ",
                    RowBox[{"-", "seqStart"}]
                   }
                  ],
                  "}"
                 }
                ]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[{RowBox[{"expr", "=", "tempNeg"}], ";"}],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "denTempPos",
              " ",
              "=",
              " ",
              RowBox[
               {
                "MapAt",
                "[",
                RowBox[
                 {
                  "Denominator",
                  ",",
                  " ",
                  RowBox[{"Together", " ", "@", " ", "expr"}],
                  ",",
                  " ",
                  RowBox[{"{", RowBox[{";;", ",", " ", "2"}], "}"}]
                 }
                ],
                "]"
               }
              ]
             }
            ],
            ";"
           }
          ],
          " ",
          RowBox[{"(*", "denominator", "*)"}]
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "numTempPos",
              " ",
              "=",
              " ",
              RowBox[
               {
                "Numerator",
                " ",
                "@",
                " ",
                RowBox[{"Together", " ", "@", " ", "expr"}]
               }
              ]
             }
            ],
            ";"
           }
          ],
          " ",
          RowBox[{"(*", "numerator", "*)"}]
         }
        ],
        "\n",
        RowBox[
         {
          "categorizedTempPos",
          " ",
          "=",
          " ",
          RowBox[
           {
            "Table",
            "[",
            "\n",
            "\t",
            RowBox[
             {
              RowBox[
               {
                "GroupBy",
                "[",
                "\n",
                "\t\t",
                RowBox[
                 {
                  RowBox[
                   {
                    "List",
                    " ",
                    "@@",
                    " ",
                    RowBox[
                     {
                      "numTempPos",
                      "[",
                      RowBox[{"[", RowBox[{"kk", ",", " ", "2"}], "]"}],
                      "]"
                     }
                    ]
                   }
                  ],
                  ",",
                  "\n",
                  "\t\t",
                  "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`Private`categorize",
                  ",",
                  "\n",
                  "\t\t",
                  RowBox[
                   {
                    RowBox[
                     {
                      "{",
                      RowBox[
                       {
                        RowBox[{"2", " ", "+", " ", "kk"}],
                        ",",
                        " ",
                        RowBox[
                         {
                          "Simplify",
                          "[",
                          RowBox[{"Plus", " ", "@@", " ", "#"}],
                          "]"
                         }
                        ]
                       }
                      ],
                      "}"
                     }
                    ],
                    "&"
                   }
                  ]
                 }
                ],
                "\n",
                "\t",
                "]"
               }
              ],
              ",",
              " ",
              "\n",
              "\t",
              RowBox[
               {
                "{",
                RowBox[
                 {
                  "kk",
                  ",",
                  " ",
                  "1",
                  ",",
                  " ",
                  RowBox[{"Length", "[", "numTempPos", "]"}]
                 }
                ],
                "}"
               }
              ]
             }
            ],
            "\n",
            "]"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "tempPos",
            " ",
            "=",
            " ",
            RowBox[
             {
              "Table",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "{",
                  RowBox[
                   {
                    "T",
                    ",",
                    " ",
                    RowBox[
                     {
                      "uncondCov",
                      "[",
                      RowBox[
                       {
                        RowBox[{"v1", "[", "t", "]"}],
                        ",",
                        " ",
                        RowBox[{"v2", "[", RowBox[{"t", " ", "+", " ", "T"}], "]"}],
                        ",",
                        " ",
                        "model"
                       }
                      ],
                      "]"
                     }
                    ]
                   }
                  ],
                  "}"
                 }
                ],
                ",",
                " ",
                RowBox[
                 {
                  "{",
                  RowBox[
                   {
                    "T",
                    ",",
                    " ",
                    "seqStart",
                    ",",
                    " ",
                    RowBox[{"maxLag", " ", "+", " ", "1"}]
                   }
                  ],
                  "}"
                 }
                ]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[{RowBox[{"s", " ", "=", " ", "seqStart"}], ";"}],
        "\n",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "covLong",
              "[",
              RowBox[
               {
                "v1",
                ",",
                " ",
                "v2",
                ",",
                " ",
                RowBox[
                 {
                  "q_",
                  " ",
                  "/;",
                  " ",
                  RowBox[
                   {
                    "q",
                    " ",
                    "<=",
                    " ",
                    RowBox[{"(", RowBox[{"-", "s"}], ")"}]
                   }
                  ]
                 }
                ]
               }
              ],
              "]"
             }
            ],
            " ",
            "=",
            " ",
            RowBox[
             {
              "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`Private`seqfun",
              "[",
              RowBox[
               {"tempNeg", ",", " ", "q", ",", " ", "v1", ",", " ", "v2"}
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "covLong",
              "[",
              RowBox[{"v1", ",", " ", "v2", ",", " ", "0"}],
              "]"
             }
            ],
            " ",
            "=",
            " ",
            RowBox[
             {
              "uncondCov",
              "[",
              RowBox[
               {
                RowBox[{"v1", "[", "t", "]"}],
                ",",
                " ",
                RowBox[{"v2", "[", "t", "]"}],
                ",",
                " ",
                "model"
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "covLong",
              "[",
              RowBox[
               {
                "v1",
                ",",
                " ",
                "v2",
                ",",
                " ",
                RowBox[
                 {"q_", " ", "/;", " ", RowBox[{"q", " ", ">=", " ", "s"}]}
                ]
               }
              ],
              "]"
             }
            ],
            " ",
            "=",
            " ",
            RowBox[
             {
              "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`Private`seqfun",
              "[",
              RowBox[
               {"tempPos", ",", " ", "q", ",", " ", "v1", ",", " ", "v2"}
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "Do",
            "[",
            "\n",
            "\t",
            RowBox[
             {
              RowBox[
               {
                RowBox[
                 {
                  RowBox[
                   {
                    "covLong",
                    "[",
                    RowBox[
                     {"v1", ",", " ", "v2", ",", " ", RowBox[{"-", "qInd"}]}
                    ],
                    "]"
                   }
                  ],
                  " ",
                  "=",
                  " ",
                  RowBox[
                   {
                    "uncondCov",
                    "[",
                    RowBox[
                     {
                      RowBox[{"v1", "[", "t", "]"}],
                      ",",
                      " ",
                      RowBox[
                       {"v2", "[", RowBox[{"t", " ", "-", " ", "qInd"}], "]"}
                      ],
                      ",",
                      " ",
                      "model"
                     }
                    ],
                    "]"
                   }
                  ]
                 }
                ],
                ";",
                "\n",
                "\t",
                RowBox[
                 {
                  RowBox[
                   {
                    "covLong",
                    "[",
                    RowBox[{"v1", ",", " ", "v2", ",", " ", "qInd"}],
                    "]"
                   }
                  ],
                  " ",
                  "=",
                  " ",
                  RowBox[
                   {
                    "uncondCov",
                    "[",
                    RowBox[
                     {
                      RowBox[{"v1", "[", "t", "]"}],
                      ",",
                      " ",
                      RowBox[
                       {"v2", "[", RowBox[{"t", " ", "+", " ", "qInd"}], "]"}
                      ],
                      ",",
                      " ",
                      "model"
                     }
                    ],
                    "]"
                   }
                  ]
                 }
                ],
                ";"
               }
              ],
              "\n",
              "\t",
              ",",
              "\n",
              "\t",
              RowBox[
               {
                "{",
                RowBox[
                 {"qInd", ",", " ", RowBox[{"s", " ", "-", " ", "1"}]}
                ],
                "}"
               }
              ]
             }
            ],
            "\n",
            "]"
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            "If",
            "[",
            "\n",
            "\t",
            RowBox[
             {
              RowBox[{"v1", " ", "=!=", " ", "v2"}],
              "\n",
              "\t",
              ",",
              "\n",
              "\t",
              RowBox[
               {
                RowBox[
                 {
                  "covLong",
                  "[",
                  RowBox[{"v2", ",", " ", "v1", ",", " ", "q_Integer"}],
                  "]"
                 }
                ],
                " ",
                "=",
                " ",
                RowBox[
                 {
                  "covLong",
                  "[",
                  RowBox[
                   {"v1", ",", " ", "v2", ",", " ", RowBox[{"-", "q"}]}
                  ],
                  "]"
                 }
                ]
               }
              ]
             }
            ],
            "\n",
            "]"
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[{"\t\t"}]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "\t",
         RowBox[
          {
           RowBox[
            {
             "ParallelDo",
             "[",
             "\n",
             "\t\t",
             RowBox[
              {
               RowBox[
                {
                 RowBox[
                  {
                   "With",
                   "[",
                   "\n",
                   "\t\t\t",
                   RowBox[
                    {
                     RowBox[
                      {
                       "{",
                       "\n",
                       "\t\t\t\t",
                       RowBox[
                        {
                         RowBox[
                          {
                           "v1",
                           "=",
                           RowBox[{"exo", "[", RowBox[{"[", "ind1", "]"}], "]"}]
                          }
                         ],
                         ",",
                         "\n",
                         "\t\t\t\t",
                         RowBox[
                          {
                           "v2",
                           "=",
                           RowBox[{"exo", "[", RowBox[{"[", "ind2", "]"}], "]"}]
                          }
                         ]
                        }
                       ],
                       "\n",
                       "\t\t\t",
                       "}"
                      }
                     ],
                     ",",
                     "\n",
                     "\t\t\t",
                     RowBox[
                      {
                       RowBox[
                        {
                         "With",
                         "[",
                         "\n",
                         "\t\t\t\t",
                         RowBox[
                          {
                           RowBox[
                            {
                             "{",
                             "\n",
                             "\t\t\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "tempNeg",
                                 " ",
                                 "=",
                                 " ",
                                 RowBox[
                                  {
                                   "Table",
                                   "[",
                                   RowBox[
                                    {
                                     RowBox[
                                      {
                                       "{",
                                       RowBox[
                                        {
                                         "T",
                                         ",",
                                         " ",
                                         RowBox[
                                          {
                                           "uncondCov",
                                           "[",
                                           RowBox[
                                            {
                                             RowBox[{"v1", "[", "t", "]"}],
                                             ",",
                                             " ",
                                             RowBox[{"v2", "[", RowBox[{"t", " ", "+", " ", "T"}], "]"}],
                                             ",",
                                             " ",
                                             "model"
                                            }
                                           ],
                                           "]"
                                          }
                                         ]
                                        }
                                       ],
                                       "}"
                                      }
                                     ],
                                     ",",
                                     " ",
                                     RowBox[
                                      {
                                       "{",
                                       RowBox[
                                        {
                                         "T",
                                         ",",
                                         " ",
                                         RowBox[{RowBox[{"-", "maxLag"}], " ", "-", " ", "1"}],
                                         ",",
                                         " ",
                                         RowBox[{"-", "seqStart"}]
                                        }
                                       ],
                                       "}"
                                      }
                                     ]
                                    }
                                   ],
                                   "]"
                                  }
                                 ]
                                }
                               ],
                               ",",
                               "\n",
                               "\t\t\t\t\t",
                               RowBox[
                                {
                                 "tempPos",
                                 " ",
                                 "=",
                                 " ",
                                 RowBox[
                                  {
                                   "Table",
                                   "[",
                                   RowBox[
                                    {
                                     RowBox[
                                      {
                                       "{",
                                       RowBox[
                                        {
                                         "T",
                                         ",",
                                         " ",
                                         RowBox[
                                          {
                                           "uncondCov",
                                           "[",
                                           RowBox[
                                            {
                                             RowBox[{"v1", "[", "t", "]"}],
                                             ",",
                                             " ",
                                             RowBox[{"v2", "[", RowBox[{"t", " ", "+", " ", "T"}], "]"}],
                                             ",",
                                             " ",
                                             "model"
                                            }
                                           ],
                                           "]"
                                          }
                                         ]
                                        }
                                       ],
                                       "}"
                                      }
                                     ],
                                     ",",
                                     " ",
                                     RowBox[
                                      {
                                       "{",
                                       RowBox[
                                        {
                                         "T",
                                         ",",
                                         " ",
                                         "seqStart",
                                         ",",
                                         " ",
                                         RowBox[{"maxLag", " ", "+", " ", "1"}]
                                        }
                                       ],
                                       "}"
                                      }
                                     ]
                                    }
                                   ],
                                   "]"
                                  }
                                 ]
                                }
                               ],
                               ",",
                               "\n",
                               "\t\t\t\t\t",
                               RowBox[{"s", " ", "=", " ", "seqStart"}]
                              }
                             ],
                             "\n",
                             "\t\t\t\t",
                             "}"
                            }
                           ],
                           "\n",
                           "\t\t\t\t",
                           ",",
                           "\n",
                           "\t\t\t\t",
                           RowBox[
                            {
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   RowBox[
                                    {
                                     "q_",
                                     " ",
                                     "/;",
                                     " ",
                                     RowBox[
                                      {
                                       "q",
                                       " ",
                                       "<=",
                                       " ",
                                       RowBox[{"(", RowBox[{"-", "s"}], ")"}]
                                      }
                                     ]
                                    }
                                   ]
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "seqfun",
                                 "[",
                                 RowBox[
                                  {"tempNeg", ",", " ", "q", ",", " ", "v1", ",", " ", "v2"}
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[{"v1", ",", " ", "v2", ",", " ", "0"}],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "uncondCov",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[{"v1", "[", "t", "]"}],
                                   ",",
                                   " ",
                                   RowBox[{"v2", "[", "t", "]"}],
                                   ",",
                                   " ",
                                   "model"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   RowBox[
                                    {"q_", " ", "/;", " ", RowBox[{"q", " ", ">=", " ", "s"}]}
                                   ]
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "seqfun",
                                 "[",
                                 RowBox[
                                  {"tempPos", ",", " ", "q", ",", " ", "v1", ",", " ", "v2"}
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t\t",
                             RowBox[
                              {
                               "Do",
                               "[",
                               "\n",
                               "\t\t\t\t\t",
                               RowBox[
                                {
                                 RowBox[
                                  {
                                   RowBox[
                                    {
                                     RowBox[
                                      {
                                       "covLong",
                                       "[",
                                       RowBox[
                                        {"v1", ",", " ", "v2", ",", " ", RowBox[{"-", "qInd"}]}
                                       ],
                                       "]"
                                      }
                                     ],
                                     " ",
                                     "=",
                                     " ",
                                     RowBox[
                                      {
                                       "uncondCov",
                                       "[",
                                       RowBox[
                                        {
                                         RowBox[{"v1", "[", "t", "]"}],
                                         ",",
                                         " ",
                                         RowBox[
                                          {"v2", "[", RowBox[{"t", " ", "-", " ", "qInd"}], "]"}
                                         ],
                                         ",",
                                         " ",
                                         "model"
                                        }
                                       ],
                                       "]"
                                      }
                                     ]
                                    }
                                   ],
                                   ";",
                                   "\n",
                                   "\t\t\t\t\t",
                                   RowBox[
                                    {
                                     RowBox[
                                      {
                                       "covLong",
                                       "[",
                                       RowBox[{"v1", ",", " ", "v2", ",", " ", "qInd"}],
                                       "]"
                                      }
                                     ],
                                     " ",
                                     "=",
                                     " ",
                                     RowBox[
                                      {
                                       "uncondCov",
                                       "[",
                                       RowBox[
                                        {
                                         RowBox[{"v1", "[", "t", "]"}],
                                         ",",
                                         " ",
                                         RowBox[
                                          {"v2", "[", RowBox[{"t", " ", "+", " ", "qInd"}], "]"}
                                         ],
                                         ",",
                                         " ",
                                         "model"
                                        }
                                       ],
                                       "]"
                                      }
                                     ]
                                    }
                                   ],
                                   ";"
                                  }
                                 ],
                                 "\n",
                                 "\t\t\t\t\t",
                                 ",",
                                 "\n",
                                 "\t\t\t\t\t",
                                 RowBox[
                                  {
                                   "{",
                                   RowBox[
                                    {"qInd", ",", " ", RowBox[{"s", " ", "-", " ", "1"}]}
                                   ],
                                   "}"
                                  }
                                 ]
                                }
                               ],
                               "\n",
                               "\t\t\t\t",
                               "]"
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t\t",
                             RowBox[
                              {
                               "If",
                               "[",
                               "\n",
                               "\t\t\t\t\t",
                               RowBox[
                                {
                                 RowBox[{"v1", " ", "=!=", " ", "v2"}],
                                 "\n",
                                 "\t\t\t\t\t",
                                 ",",
                                 "\n",
                                 "\t\t\t\t\t",
                                 RowBox[
                                  {
                                   RowBox[
                                    {
                                     "covLong",
                                     "[",
                                     RowBox[{"v2", ",", " ", "v1", ",", " ", "q_Integer"}],
                                     "]"
                                    }
                                   ],
                                   " ",
                                   "=",
                                   " ",
                                   RowBox[
                                    {
                                     "covLong",
                                     "[",
                                     RowBox[
                                      {"v1", ",", " ", "v2", ",", " ", RowBox[{"-", "q"}]}
                                     ],
                                     "]"
                                    }
                                   ]
                                  }
                                 ]
                                }
                               ],
                               "\n",
                               "\t\t\t\t",
                               "]"
                              }
                             ],
                             ";"
                            }
                           ]
                          }
                         ],
                         "\n",
                         "\t\t\t",
                         "]"
                        }
                       ],
                       ";"
                      }
                     ]
                    }
                   ],
                   RowBox[{"(*", "With", "*)"}],
                   "\n",
                   "\t\t",
                   "]"
                  }
                 ],
                 ";"
                }
               ],
               RowBox[{"(*", "With", "*)"}],
               "\n",
               "\t\t",
               ",",
               "\n",
               "\t\t",
               RowBox[
                {
                 "{",
                 RowBox[
                  {"ind1", ",", " ", RowBox[{"Length", "[", "exo", "]"}]}
                 ],
                 "}"
                }
               ],
               "\n",
               "\t\t",
               ",",
               "\n",
               "\t\t",
               RowBox[{"{", RowBox[{"ind2", ",", " ", "ind1"}], "}"}],
               "\n",
               "\t\t",
               ",",
               "\n",
               "\t\t",
               RowBox[{"DistributedContexts", " ", "->", " ", "All"}]
              }
             ],
             "\n",
             "\t",
             "]"
            }
           ],
           ";"
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[BoxData["exo"], "Input"],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          {
           RowBox[{RowBox[{"ind1", "=", "1"}], ";"}],
           "\[IndentingNewLine]",
           RowBox[{RowBox[{"ind2", "=", "4"}], ";"}],
           "\[IndentingNewLine]",
           RowBox[
            {
             "v1",
             " ",
             "=",
             " ",
             RowBox[{"exoStocks", "[", RowBox[{"[", "ind1", "]"}], "]"}]
            }
           ],
           "\n",
           RowBox[
            {
             "v2",
             " ",
             "=",
             " ",
             RowBox[{"exo", "[", RowBox[{"[", "ind2", "]"}], "]"}]
            }
           ],
           "\[IndentingNewLine]",
           RowBox[{RowBox[{"s", " ", "=", " ", "seqStart"}], ";"}],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {"ClearAll", "[", RowBox[{"tempNeg", ",", "tempPos"}], "]"}
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "tempNeg",
               " ",
               "=",
               " ",
               RowBox[
                {
                 "Table",
                 "[",
                 RowBox[
                  {
                   RowBox[
                    {
                     "{",
                     RowBox[
                      {
                       "T",
                       ",",
                       " ",
                       RowBox[
                        {
                         "uncondCov",
                         "[",
                         RowBox[
                          {
                           RowBox[{"v1", "[", RowBox[{"t", ",", " ", "j"}], "]"}],
                           ",",
                           " ",
                           RowBox[{"v2", "[", RowBox[{"t", " ", "+", " ", "T"}], "]"}],
                           ",",
                           " ",
                           "model"
                          }
                         ],
                         "]"
                        }
                       ]
                      }
                     ],
                     "}"
                    }
                   ],
                   ",",
                   " ",
                   RowBox[
                    {
                     "{",
                     RowBox[
                      {
                       "T",
                       ",",
                       " ",
                       RowBox[{RowBox[{"-", "maxLag"}], " ", "-", " ", "1"}],
                       ",",
                       " ",
                       RowBox[{"-", "seqStart"}]
                      }
                     ],
                     "}"
                    }
                   ]
                  }
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ]
          }
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "\[IndentingNewLine]",
         RowBox[
          {
           RowBox[
            {
             "seqfun",
             "[",
             RowBox[
              {
               RowBox[{"tempNeg", "[", "j", "]"}],
               ",",
               " ",
               "q",
               ",",
               " ",
               "v1",
               ",",
               " ",
               "v2"
              }
             ],
             "]"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "tempPos",
               " ",
               "=",
               " ",
               RowBox[
                {
                 "Table",
                 "[",
                 RowBox[
                  {
                   RowBox[
                    {
                     "{",
                     RowBox[
                      {
                       "T",
                       ",",
                       " ",
                       RowBox[
                        {
                         "uncondCov",
                         "[",
                         RowBox[
                          {
                           RowBox[{"v1", "[", RowBox[{"t", ",", " ", "j"}], "]"}],
                           ",",
                           " ",
                           RowBox[{"v2", "[", RowBox[{"t", " ", "+", " ", "T"}], "]"}],
                           ",",
                           " ",
                           "model"
                          }
                         ],
                         "]"
                        }
                       ]
                      }
                     ],
                     "}"
                    }
                   ],
                   ",",
                   " ",
                   RowBox[
                    {
                     "{",
                     RowBox[
                      {
                       "T",
                       ",",
                       " ",
                       "seqStart",
                       ",",
                       " ",
                       RowBox[{"maxLag", " ", "+", " ", "1"}]
                      }
                     ],
                     "}"
                    }
                   ]
                  }
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             "seqfun",
             "[",
             RowBox[
              {
               RowBox[{"tempPos", "[", "j", "]"}],
               ",",
               " ",
               "q",
               ",",
               " ",
               "v1",
               ",",
               " ",
               "v2"
              }
             ],
             "]"
            }
           ]
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "(*",
           RowBox[{"moments", " ", "with", " ", "one", " ", "stock"}],
           "*)"
          }
         ],
         "\n",
         RowBox[
          {
           RowBox[
            {
             "ParallelDo",
             "[",
             "\n",
             "\t",
             RowBox[
              {
               RowBox[
                {
                 RowBox[
                  {
                   "With",
                   "[",
                   "\n",
                   "\t\t",
                   RowBox[
                    {
                     RowBox[
                      {
                       "{",
                       "\n",
                       "\t\t\t",
                       RowBox[
                        {
                         RowBox[
                          {
                           "v1",
                           " ",
                           "=",
                           " ",
                           RowBox[{"exoStocks", "[", RowBox[{"[", "ind1", "]"}], "]"}]
                          }
                         ],
                         ",",
                         "\n",
                         "\t\t\t",
                         RowBox[
                          {
                           "v2",
                           " ",
                           "=",
                           " ",
                           RowBox[{"exo", "[", RowBox[{"[", "ind2", "]"}], "]"}]
                          }
                         ],
                         ",",
                         "\n",
                         "\t\t\t",
                         RowBox[{"s", " ", "=", " ", "seqStart"}]
                        }
                       ],
                       "\n",
                       "\t\t",
                       "}"
                      }
                     ],
                     ",",
                     "\n",
                     "\t\t",
                     RowBox[
                      {
                       RowBox[
                        {
                         "Module",
                         "[",
                         "\n",
                         "\t\t\t",
                         RowBox[
                          {
                           RowBox[
                            {"{", RowBox[{"tempNeg", ",", " ", "tempPos"}], "}"}
                           ],
                           "\n",
                           "\t\t\t",
                           ",",
                           "\n",
                           "\t\t\t",
                           RowBox[
                            {
                             RowBox[
                              {
                               RowBox[{"tempNeg", "[", "j_", "]"}],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "Table",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[
                                    {
                                     "{",
                                     RowBox[
                                      {
                                       "T",
                                       ",",
                                       " ",
                                       RowBox[
                                        {
                                         "uncondCov",
                                         "[",
                                         RowBox[
                                          {
                                           RowBox[{"v1", "[", RowBox[{"t", ",", " ", "j"}], "]"}],
                                           ",",
                                           " ",
                                           RowBox[{"v2", "[", RowBox[{"t", " ", "+", " ", "T"}], "]"}],
                                           ",",
                                           " ",
                                           "model"
                                          }
                                         ],
                                         "]"
                                        }
                                       ]
                                      }
                                     ],
                                     "}"
                                    }
                                   ],
                                   ",",
                                   " ",
                                   RowBox[
                                    {
                                     "{",
                                     RowBox[
                                      {
                                       "T",
                                       ",",
                                       " ",
                                       RowBox[{RowBox[{"-", "maxLag"}], " ", "-", " ", "1"}],
                                       ",",
                                       " ",
                                       RowBox[{"-", "seqStart"}]
                                      }
                                     ],
                                     "}"
                                    }
                                   ]
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[{"tempPos", "[", "j_", "]"}],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "Table",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[
                                    {
                                     "{",
                                     RowBox[
                                      {
                                       "T",
                                       ",",
                                       " ",
                                       RowBox[
                                        {
                                         "uncondCov",
                                         "[",
                                         RowBox[
                                          {
                                           RowBox[{"v1", "[", RowBox[{"t", ",", " ", "j"}], "]"}],
                                           ",",
                                           " ",
                                           RowBox[{"v2", "[", RowBox[{"t", " ", "+", " ", "T"}], "]"}],
                                           ",",
                                           " ",
                                           "model"
                                          }
                                         ],
                                         "]"
                                        }
                                       ]
                                      }
                                     ],
                                     "}"
                                    }
                                   ],
                                   ",",
                                   " ",
                                   RowBox[
                                    {
                                     "{",
                                     RowBox[
                                      {
                                       "T",
                                       ",",
                                       " ",
                                       "seqStart",
                                       ",",
                                       " ",
                                       RowBox[{"maxLag", " ", "+", " ", "1"}]
                                      }
                                     ],
                                     "}"
                                    }
                                   ]
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   RowBox[
                                    {
                                     "q_",
                                     " ",
                                     "/;",
                                     " ",
                                     RowBox[
                                      {
                                       "q",
                                       " ",
                                       "<=",
                                       " ",
                                       RowBox[{"(", RowBox[{"-", "s"}], ")"}]
                                      }
                                     ]
                                    }
                                   ],
                                   ",",
                                   " ",
                                   "j_"
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "seqfun",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[{"tempNeg", "[", "j", "]"}],
                                   ",",
                                   " ",
                                   "q",
                                   ",",
                                   " ",
                                   "v1",
                                   ",",
                                   " ",
                                   "v2"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {"v1", ",", " ", "v2", ",", " ", "0", ",", " ", "j_"}
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "uncondCov",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[{"v1", "[", RowBox[{"t", ",", " ", "j"}], "]"}],
                                   ",",
                                   " ",
                                   RowBox[{"v2", "[", "t", "]"}],
                                   ",",
                                   " ",
                                   "model"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   RowBox[
                                    {"q_", " ", "/;", " ", RowBox[{"q", " ", ">=", " ", "s"}]}
                                   ],
                                   ",",
                                   " ",
                                   "j_"
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "seqfun",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[{"tempPos", "[", "j", "]"}],
                                   ",",
                                   " ",
                                   "q",
                                   ",",
                                   " ",
                                   "v1",
                                   ",",
                                   " ",
                                   "v2"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               "Do",
                               "[",
                               "\n",
                               "\t\t\t\t",
                               RowBox[
                                {
                                 RowBox[
                                  {
                                   RowBox[
                                    {
                                     RowBox[
                                      {
                                       "covLong",
                                       "[",
                                       RowBox[
                                        {
                                         "v1",
                                         ",",
                                         " ",
                                         "v2",
                                         ",",
                                         " ",
                                         RowBox[{"-", "qInd"}],
                                         ",",
                                         " ",
                                         "j_"
                                        }
                                       ],
                                       "]"
                                      }
                                     ],
                                     " ",
                                     "=",
                                     " ",
                                     RowBox[
                                      {
                                       "uncondCov",
                                       "[",
                                       RowBox[
                                        {
                                         RowBox[{"v1", "[", RowBox[{"t", ",", " ", "j"}], "]"}],
                                         ",",
                                         " ",
                                         RowBox[
                                          {"v2", "[", RowBox[{"t", " ", "-", " ", "qInd"}], "]"}
                                         ],
                                         ",",
                                         " ",
                                         "model"
                                        }
                                       ],
                                       "]"
                                      }
                                     ]
                                    }
                                   ],
                                   ";",
                                   "\n",
                                   "\t\t\t\t",
                                   RowBox[
                                    {
                                     RowBox[
                                      {
                                       "covLong",
                                       "[",
                                       RowBox[
                                        {"v1", ",", " ", "v2", ",", " ", "qInd", ",", " ", "j_"}
                                       ],
                                       "]"
                                      }
                                     ],
                                     " ",
                                     "=",
                                     " ",
                                     RowBox[
                                      {
                                       "uncondCov",
                                       "[",
                                       RowBox[
                                        {
                                         RowBox[{"v1", "[", RowBox[{"t", ",", " ", "j"}], "]"}],
                                         ",",
                                         " ",
                                         RowBox[
                                          {"v2", "[", RowBox[{"t", " ", "+", " ", "qInd"}], "]"}
                                         ],
                                         ",",
                                         " ",
                                         "model"
                                        }
                                       ],
                                       "]"
                                      }
                                     ]
                                    }
                                   ],
                                   ";"
                                  }
                                 ],
                                 "\n",
                                 "\t\t\t\t",
                                 ",",
                                 "\n",
                                 "\t\t\t\t",
                                 RowBox[
                                  {
                                   "{",
                                   RowBox[
                                    {"qInd", ",", " ", RowBox[{"s", " ", "-", " ", "1"}]}
                                   ],
                                   "}"
                                  }
                                 ]
                                }
                               ],
                               "\n",
                               "\t\t\t",
                               "]"
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v2",
                                   ",",
                                   " ",
                                   "v1",
                                   ",",
                                   " ",
                                   "q_Integer",
                                   ",",
                                   " ",
                                   "j_"
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   RowBox[{"-", "q"}],
                                   ",",
                                   " ",
                                   "j"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";"
                            }
                           ]
                          }
                         ],
                         "\n",
                         "\t\t",
                         "]"
                        }
                       ],
                       ";"
                      }
                     ]
                    }
                   ],
                   RowBox[{"(*", "Module", "*)"}],
                   "\n",
                   "\t",
                   "]"
                  }
                 ],
                 ";"
                }
               ],
               RowBox[{"(*", "With", "*)"}],
               "\n",
               "\t",
               ",",
               "\n",
               "\t",
               RowBox[
                {
                 "{",
                 RowBox[
                  {
                   "ind1",
                   ",",
                   " ",
                   RowBox[{"Length", "[", "exoStocks", "]"}]
                  }
                 ],
                 "}"
                }
               ],
               "\n",
               "\t",
               ",",
               "\n",
               "\t",
               RowBox[
                {
                 "{",
                 RowBox[
                  {"ind2", ",", " ", RowBox[{"Length", "[", "exo", "]"}]}
                 ],
                 "}"
                }
               ],
               "\n",
               "\t",
               ",",
               "\n",
               "\t",
               RowBox[{"DistributedContexts", " ", "->", " ", "All"}]
              }
             ],
             "\n",
             "]"
            }
           ],
           ";"
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          RowBox[
           {
            "Definition",
            "@",
            "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`Private`partitionBy"
           }
          ]
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "(*",
           RowBox[{"moments", " ", "with", " ", "two", " ", "stocks"}],
           "*)"
          }
         ],
         "\n",
         RowBox[
          {
           RowBox[
            {
             "ParallelDo",
             "[",
             "\n",
             "\t",
             RowBox[
              {
               RowBox[
                {
                 RowBox[
                  {
                   "With",
                   "[",
                   "\n",
                   "\t\t",
                   RowBox[
                    {
                     RowBox[
                      {
                       "{",
                       "\n",
                       "\t\t\t",
                       RowBox[
                        {
                         RowBox[
                          {
                           "v1",
                           " ",
                           "=",
                           " ",
                           RowBox[{"exoStocks", "[", RowBox[{"[", "ind1", "]"}], "]"}]
                          }
                         ],
                         ",",
                         "\n",
                         "\t\t\t",
                         RowBox[
                          {
                           "v2",
                           " ",
                           "=",
                           " ",
                           RowBox[{"exoStocks", "[", RowBox[{"[", "ind2", "]"}], "]"}]
                          }
                         ],
                         ",",
                         "\n",
                         "\t\t\t",
                         RowBox[{"s", " ", "=", " ", "seqStart"}]
                        }
                       ],
                       "\n",
                       "\t\t",
                       "}"
                      }
                     ],
                     ",",
                     "\n",
                     "\t\t",
                     RowBox[
                      {
                       RowBox[
                        {
                         "Module",
                         "[",
                         "\n",
                         "\t\t\t",
                         RowBox[
                          {
                           RowBox[
                            {"{", RowBox[{"tempNeg", ",", " ", "tempPos"}], "}"}
                           ],
                           "\n",
                           "\t\t\t",
                           ",",
                           "\n",
                           "\t\t\t",
                           RowBox[
                            {
                             RowBox[
                              {
                               RowBox[
                                {"tempNeg", "[", RowBox[{"i_", ",", " ", "j_"}], "]"}
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "Table",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[
                                    {
                                     "{",
                                     RowBox[
                                      {
                                       "T",
                                       ",",
                                       " ",
                                       RowBox[
                                        {
                                         "uncondCov",
                                         "[",
                                         RowBox[
                                          {
                                           RowBox[{"v1", "[", RowBox[{"t", ",", " ", "i"}], "]"}],
                                           ",",
                                           " ",
                                           RowBox[
                                            {
                                             "v2",
                                             "[",
                                             RowBox[{RowBox[{"t", " ", "+", " ", "T"}], ",", " ", "j"}],
                                             "]"
                                            }
                                           ],
                                           ",",
                                           " ",
                                           "model"
                                          }
                                         ],
                                         "]"
                                        }
                                       ]
                                      }
                                     ],
                                     "}"
                                    }
                                   ],
                                   ",",
                                   " ",
                                   RowBox[
                                    {
                                     "{",
                                     RowBox[
                                      {
                                       "T",
                                       ",",
                                       " ",
                                       RowBox[{RowBox[{"-", "maxLag"}], " ", "-", " ", "1"}],
                                       ",",
                                       " ",
                                       RowBox[{"-", "seqStart"}]
                                      }
                                     ],
                                     "}"
                                    }
                                   ]
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {"tempPos", "[", RowBox[{"i_", ",", " ", "j_"}], "]"}
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "Table",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[
                                    {
                                     "{",
                                     RowBox[
                                      {
                                       "T",
                                       ",",
                                       " ",
                                       RowBox[
                                        {
                                         "uncondCov",
                                         "[",
                                         RowBox[
                                          {
                                           RowBox[{"v1", "[", RowBox[{"t", ",", " ", "i"}], "]"}],
                                           ",",
                                           " ",
                                           RowBox[
                                            {
                                             "v2",
                                             "[",
                                             RowBox[{RowBox[{"t", " ", "+", " ", "T"}], ",", " ", "j"}],
                                             "]"
                                            }
                                           ],
                                           ",",
                                           " ",
                                           "model"
                                          }
                                         ],
                                         "]"
                                        }
                                       ]
                                      }
                                     ],
                                     "}"
                                    }
                                   ],
                                   ",",
                                   " ",
                                   RowBox[
                                    {
                                     "{",
                                     RowBox[
                                      {
                                       "T",
                                       ",",
                                       " ",
                                       "seqStart",
                                       ",",
                                       " ",
                                       RowBox[{"maxLag", " ", "+", " ", "1"}]
                                      }
                                     ],
                                     "}"
                                    }
                                   ]
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   RowBox[
                                    {
                                     "q_",
                                     " ",
                                     "/;",
                                     " ",
                                     RowBox[
                                      {
                                       "q",
                                       " ",
                                       "<=",
                                       " ",
                                       RowBox[{"(", RowBox[{"-", "s"}], ")"}]
                                      }
                                     ]
                                    }
                                   ],
                                   ",",
                                   " ",
                                   "i_",
                                   ",",
                                   " ",
                                   "j_"
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "seqfun",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[{"tempNeg", "[", RowBox[{"i", ",", " ", "j"}], "]"}],
                                   ",",
                                   " ",
                                   "q",
                                   ",",
                                   " ",
                                   "v1",
                                   ",",
                                   " ",
                                   "v2"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   "0",
                                   ",",
                                   " ",
                                   "i_",
                                   ",",
                                   " ",
                                   "j_"
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "uncondCov",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[{"v1", "[", RowBox[{"t", ",", " ", "i"}], "]"}],
                                   ",",
                                   " ",
                                   RowBox[{"v2", "[", RowBox[{"t", ",", " ", "j"}], "]"}],
                                   ",",
                                   " ",
                                   "model"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   RowBox[
                                    {"q_", " ", "/;", " ", RowBox[{"q", " ", ">=", " ", "s"}]}
                                   ],
                                   ",",
                                   " ",
                                   "i_",
                                   ",",
                                   " ",
                                   "j_"
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "seqfun",
                                 "[",
                                 RowBox[
                                  {
                                   RowBox[{"tempPos", "[", RowBox[{"i", ",", " ", "j"}], "]"}],
                                   ",",
                                   " ",
                                   "q",
                                   ",",
                                   " ",
                                   "v1",
                                   ",",
                                   " ",
                                   "v2"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               "Do",
                               "[",
                               "\n",
                               "\t\t\t\t",
                               RowBox[
                                {
                                 RowBox[
                                  {
                                   RowBox[
                                    {
                                     RowBox[
                                      {
                                       "covLong",
                                       "[",
                                       RowBox[
                                        {
                                         "v1",
                                         ",",
                                         " ",
                                         "v2",
                                         ",",
                                         " ",
                                         RowBox[{"-", "qInd"}],
                                         ",",
                                         " ",
                                         "i_",
                                         ",",
                                         " ",
                                         "j_"
                                        }
                                       ],
                                       "]"
                                      }
                                     ],
                                     " ",
                                     "=",
                                     " ",
                                     RowBox[
                                      {
                                       "uncondCov",
                                       "[",
                                       RowBox[
                                        {
                                         RowBox[{"v1", "[", RowBox[{"t", ",", " ", "i"}], "]"}],
                                         ",",
                                         " ",
                                         RowBox[
                                          {
                                           "v2",
                                           "[",
                                           RowBox[
                                            {RowBox[{"t", " ", "-", " ", "qInd"}], ",", " ", "j"}
                                           ],
                                           "]"
                                          }
                                         ],
                                         ",",
                                         " ",
                                         "model"
                                        }
                                       ],
                                       "]"
                                      }
                                     ]
                                    }
                                   ],
                                   ";",
                                   "\n",
                                   "\t\t\t\t",
                                   RowBox[
                                    {
                                     RowBox[
                                      {
                                       "covLong",
                                       "[",
                                       RowBox[
                                        {
                                         "v1",
                                         ",",
                                         " ",
                                         "v2",
                                         ",",
                                         " ",
                                         "qInd",
                                         ",",
                                         " ",
                                         "i_",
                                         ",",
                                         " ",
                                         "j_"
                                        }
                                       ],
                                       "]"
                                      }
                                     ],
                                     " ",
                                     "=",
                                     " ",
                                     RowBox[
                                      {
                                       "uncondCov",
                                       "[",
                                       RowBox[
                                        {
                                         RowBox[{"v1", "[", RowBox[{"t", ",", " ", "i"}], "]"}],
                                         ",",
                                         " ",
                                         RowBox[
                                          {
                                           "v2",
                                           "[",
                                           RowBox[
                                            {RowBox[{"t", " ", "+", " ", "qInd"}], ",", " ", "j"}
                                           ],
                                           "]"
                                          }
                                         ],
                                         ",",
                                         " ",
                                         "model"
                                        }
                                       ],
                                       "]"
                                      }
                                     ]
                                    }
                                   ],
                                   ";"
                                  }
                                 ],
                                 "\n",
                                 "\t\t\t\t",
                                 ",",
                                 "\n",
                                 "\t\t\t\t",
                                 RowBox[
                                  {
                                   "{",
                                   RowBox[
                                    {"qInd", ",", " ", RowBox[{"s", " ", "-", " ", "1"}]}
                                   ],
                                   "}"
                                  }
                                 ]
                                }
                               ],
                               "\n",
                               "\t\t\t",
                               "]"
                              }
                             ],
                             ";",
                             "\n",
                             "\t\t\t",
                             RowBox[
                              {
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v2",
                                   ",",
                                   " ",
                                   "v1",
                                   ",",
                                   " ",
                                   "q_Integer",
                                   ",",
                                   " ",
                                   "i_",
                                   ",",
                                   " ",
                                   "j_"
                                  }
                                 ],
                                 "]"
                                }
                               ],
                               " ",
                               "=",
                               " ",
                               RowBox[
                                {
                                 "covLong",
                                 "[",
                                 RowBox[
                                  {
                                   "v1",
                                   ",",
                                   " ",
                                   "v2",
                                   ",",
                                   " ",
                                   RowBox[{"-", "q"}],
                                   ",",
                                   " ",
                                   "j",
                                   ",",
                                   " ",
                                   "i"
                                  }
                                 ],
                                 "]"
                                }
                               ]
                              }
                             ],
                             ";"
                            }
                           ]
                          }
                         ],
                         "\n",
                         "\t\t",
                         "]"
                        }
                       ],
                       ";"
                      }
                     ]
                    }
                   ],
                   RowBox[{"(*", "Module", "*)"}],
                   "\n",
                   "\t",
                   "]"
                  }
                 ],
                 ";"
                }
               ],
               RowBox[{"(*", "With", "*)"}],
               "\n",
               "\t",
               ",",
               "\n",
               "\t",
               RowBox[
                {
                 "{",
                 RowBox[
                  {
                   "ind1",
                   ",",
                   " ",
                   RowBox[{"Length", "[", "exoStocks", "]"}]
                  }
                 ],
                 "}"
                }
               ],
               "\n",
               "\t",
               ",",
               "\n",
               "\t",
               RowBox[{"{", RowBox[{"ind2", ",", " ", "ind1"}], "}"}],
               "\n",
               "\t",
               ",",
               "\n",
               "\t",
               RowBox[{"DistributedContexts", " ", "->", " ", "All"}]
              }
             ],
             "\n",
             "]"
            }
           ],
           ";"
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[CellGroupData[{Cell[BoxData["exo"], "Input"]}, Open]],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          {
           RowBox[{RowBox[{"ind1", "=", "4"}], ";"}],
           "\[IndentingNewLine]",
           RowBox[{RowBox[{"ind2", "=", "1"}], ";"}],
           "\[IndentingNewLine]",
           RowBox[
            {
             "v1",
             " ",
             "=",
             " ",
             RowBox[{"exo", "[", RowBox[{"[", "ind1", "]"}], "]"}]
            }
           ],
           "\n",
           RowBox[
            {
             "v2",
             " ",
             "=",
             " ",
             RowBox[{"exoStocks", "[", RowBox[{"[", "ind2", "]"}], "]"}]
            }
           ],
           "\[IndentingNewLine]",
           RowBox[{RowBox[{"s", " ", "=", " ", "seqStart"}], ";"}],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {"ClearAll", "[", RowBox[{"tempNeg", ",", "tempPos"}], "]"}
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "tempNeg",
               " ",
               "=",
               " ",
               RowBox[
                {
                 "Table",
                 "[",
                 RowBox[
                  {
                   RowBox[
                    {
                     "{",
                     RowBox[
                      {
                       "T",
                       ",",
                       " ",
                       RowBox[
                        {
                         "uncondCov",
                         "[",
                         RowBox[
                          {
                           RowBox[{"v1", "[", "t", "]"}],
                           ",",
                           " ",
                           RowBox[
                            {
                             "v2",
                             "[",
                             RowBox[{RowBox[{"t", " ", "+", " ", "T"}], ",", "k"}],
                             "]"
                            }
                           ],
                           ",",
                           " ",
                           "model"
                          }
                         ],
                         "]"
                        }
                       ]
                      }
                     ],
                     "}"
                    }
                   ],
                   ",",
                   " ",
                   RowBox[
                    {
                     "{",
                     RowBox[
                      {
                       "T",
                       ",",
                       " ",
                       RowBox[{RowBox[{"-", "maxLag"}], " ", "-", " ", "1"}],
                       ",",
                       " ",
                       RowBox[{"-", "seqStart"}]
                      }
                     ],
                     "}"
                    }
                   ]
                  }
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ]
          }
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          RowBox[
           {
            "seqfun",
            "[",
            RowBox[{"tempNeg", ",", "q", ",", "v1", ",", "v2"}],
            "]"
           }
          ]
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          RowBox[
           {
            RowBox[
             {
              "Simplify",
              "@",
              RowBox[{"SetSymbolsContext", "@", "numTempPos"}]
             }
            ],
            " ",
            "//",
            "TableForm"
           }
          ]
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      CellGroupData[
       {Cell[BoxData["partitionWithValue"], "Input"]},
       Open
      ]
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          {
           RowBox[{RowBox[{"expr", "=", "tempNeg"}], ";"}],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               RowBox[
                {
                 "denTempPos",
                 " ",
                 "=",
                 " ",
                 RowBox[
                  {
                   "MapAt",
                   "[",
                   RowBox[
                    {
                     "Denominator",
                     ",",
                     " ",
                     RowBox[{"Together", " ", "@", " ", "expr"}],
                     ",",
                     " ",
                     RowBox[{"{", RowBox[{";;", ",", " ", "2"}], "}"}]
                    }
                   ],
                   "]"
                  }
                 ]
                }
               ],
               ";"
              }
             ],
             " ",
             RowBox[{"(*", "denominator", "*)"}]
            }
           ],
           "\n",
           RowBox[
            {
             "\t\t",
             RowBox[
              {
               RowBox[
                {
                 "numTempPos",
                 " ",
                 "=",
                 " ",
                 RowBox[
                  {
                   "Numerator",
                   " ",
                   "@",
                   " ",
                   RowBox[{"Together", " ", "@", " ", "expr"}]
                  }
                 ]
                }
               ],
               ";"
              }
             ],
             " ",
             RowBox[{"(*", "numerator", "*)"}]
            }
           ],
           "\n",
           RowBox[
            {
             "\t\t",
             RowBox[
              {
               "categorizedTempPos",
               " ",
               "=",
               " ",
               RowBox[
                {
                 RowBox[
                  {
                   "Table",
                   "[",
                   "\n",
                   "\t\t\t",
                   RowBox[
                    {
                     RowBox[
                      {
                       "GroupBy",
                       "[",
                       "\n",
                       "\t\t\t\t",
                       RowBox[
                        {
                         RowBox[
                          {
                           "List",
                           " ",
                           "@@",
                           " ",
                           RowBox[
                            {
                             "numTempPos",
                             "[",
                             RowBox[{"[", RowBox[{"kk", ",", " ", "2"}], "]"}],
                             "]"
                            }
                           ]
                          }
                         ],
                         ",",
                         "\n",
                         "\t\t\t\t",
                         "categorize",
                         ",",
                         "\n",
                         "\t\t\t\t",
                         RowBox[
                          {
                           RowBox[
                            {
                             "{",
                             RowBox[
                              {
                               RowBox[{"2", " ", "+", " ", "kk"}],
                               ",",
                               " ",
                               RowBox[
                                {
                                 "Simplify",
                                 "[",
                                 RowBox[{"Plus", " ", "@@", " ", "#"}],
                                 "]"
                                }
                               ]
                              }
                             ],
                             "}"
                            }
                           ],
                           "&"
                          }
                         ]
                        }
                       ],
                       "\n",
                       "\t\t\t",
                       "]"
                      }
                     ],
                     ",",
                     " ",
                     "\n",
                     "\t\t\t",
                     RowBox[
                      {
                       "{",
                       RowBox[
                        {
                         "kk",
                         ",",
                         " ",
                         "1",
                         ",",
                         " ",
                         RowBox[{"Length", "[", "numTempPos", "]"}]
                        }
                       ],
                       "}"
                      }
                     ]
                    }
                   ],
                   "\n",
                   "\t\t",
                   "]"
                  }
                 ],
                 "//",
                 "Simplify"
                }
               ]
              }
             ]
            }
           ]
          }
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[
          RowBox[
           {
            "Collect",
            "[",
            RowBox[
             {
              RowBox[
               {
                "tempNeg",
                "[",
                RowBox[{"[", RowBox[{"1", ",", "2"}], "]"}],
                "]"
               }
              ],
              ",",
              "FernandoDuarte`LongRunRisk`Model`Parameters`rhodx"
             }
            ],
            "]"
           }
          ]
         ],
         "Input"
        ]
       },
       Open
      ]
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "allVars",
           "=",
           RowBox[
            {
             "{",
             RowBox[
              {
               RowBox[{"x", "[", "t", "]"}],
               ",",
               RowBox[{"pi", "[", "t", "]"}],
               ",",
               RowBox[{"pibar", "[", "t", "]"}],
               ",",
               RowBox[{"dc", "[", "t", "]"}],
               ",",
               RowBox[{"sg", "[", "t", "]"}],
               ",",
               RowBox[{"sx", "[", "t", "]"}],
               ",",
               RowBox[{"sc", "[", "t", "]"}],
               ",",
               RowBox[{"sp", "[", "t", "]"}],
               ",",
               RowBox[{"dd", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[{"wc", "[", "t", "]"}],
               ",",
               RowBox[{"pd", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[{"bond", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[{"nombond", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[{"bondexcret", "[", RowBox[{"t", ",", "2"}], "]"}],
               ",",
               RowBox[{"bondfw", "[", RowBox[{"t", ",", "2"}], "]"}],
               ",",
               RowBox[{"bondfwspread", "[", RowBox[{"t", ",", "2"}], "]"}],
               ",",
               RowBox[{"bondret", "[", RowBox[{"t", ",", "2"}], "]"}],
               ",",
               RowBox[{"bondyield", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[{"excretc", "[", "t", "]"}],
               ",",
               RowBox[{"excret", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[
                {"nombondexcret", "[", RowBox[{"t", ",", "2"}], "]"}
               ],
               ",",
               RowBox[{"nombondfw", "[", RowBox[{"t", ",", "2"}], "]"}],
               ",",
               RowBox[
                {"nombondfwspread", "[", RowBox[{"t", ",", "2"}], "]"}
               ],
               ",",
               RowBox[{"nombondret", "[", RowBox[{"t", ",", "2"}], "]"}],
               ",",
               RowBox[{"nombondyield", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[{"nomrf", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[{"nomsdf", "[", "t", "]"}],
               ",",
               RowBox[{"retc", "[", "t", "]"}],
               ",",
               RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
               ",",
               RowBox[{"rf", "[", "t", "]"}],
               ",",
               RowBox[{"sdf", "[", "t", "]"}],
               ",",
               RowBox[{"kappa0", "[", "Ewc", "]"}],
               ",",
               RowBox[{"kappa1", "[", "Ewc", "]"}],
               ",",
               RowBox[
                {"kappa0", "[", RowBox[{"Epd", "[", "1", "]"}], "]"}
               ],
               ",",
               RowBox[
                {"kappa1", "[", RowBox[{"Epd", "[", "1", "]"}], "]"}
               ]
              }
             ],
             "}"
            }
           ]
          }
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {"model", "=", RowBox[{"Models", "[", "\"NRC\"", "]"}]}
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           RowBox[
            {
             RowBox[
              {
               RowBox[{"ToNum", "[", RowBox[{"#", ",", "model"}], "]"}],
               "&"
              }
             ],
             "/@",
             "allVars"
            }
           ],
           "//",
           "Simplify"
          }
         ],
         "//",
         "TableForm"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            RowBox[{"UncondE", "[", RowBox[{"#", ",", "model"}], "]"}],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[{RowBox[{"UncondE", "[", "#", "]"}], ",", "model"}],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "c1",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {"UncondVar", "[", RowBox[{"#", ",", "model"}], "]"}
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "c1num",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {RowBox[{"UncondVar", "[", "#", "]"}], ",", "model"}
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "cL",
         "=",
         RowBox[
          {
           "Symbol",
           "[",
           RowBox[
            {
             "\"covLong\"",
             "<>",
             RowBox[{"model", "[", "\"shortname\"", "]"}]
            }
           ],
           "]"
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "DeleteDuplicates",
         "@",
         RowBox[
          {
           "Cases",
           "[",
           RowBox[
            {
             RowBox[
              {
               "Pick",
               "[",
               RowBox[
                {
                 "c1",
                 ",",
                 RowBox[
                  {
                   RowBox[
                    {
                     RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                     "&"
                    }
                   ],
                   "/@",
                   "c1"
                  }
                 ],
                 ",",
                 "False"
                }
               ],
               "]"
              }
             ],
             ",",
             RowBox[
              {
               RowBox[{"cL", "[", "x__", "]"}],
               ":>",
               RowBox[{"cL", "[", "x", "]"}]
              }
             ],
             ",",
             RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
            }
           ],
           "]"
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "uc1",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "UncondCov",
                "[",
                RowBox[
                 {RowBox[{"dc", "[", "t", "]"}], ",", "#", ",", "model"}
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "uc2",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "UncondCov",
                "[",
                RowBox[
                 {
                  RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
                  ",",
                  "#",
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "uc3",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "UncondCov",
                "[",
                RowBox[
                 {
                  RowBox[{"bondret", "[", RowBox[{"t", ",", "1"}], "]"}],
                  ",",
                  "#",
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "uc4",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "UncondCov",
                "[",
                RowBox[
                 {RowBox[{"nomsdf", "[", "t", "]"}], ",", "#", ",", "model"}
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "DeleteDuplicates",
          "@",
          RowBox[
           {
            "Cases",
            "[",
            RowBox[
             {
              RowBox[
               {
                "Pick",
                "[",
                RowBox[
                 {
                  "uc1",
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                      "&"
                     }
                    ],
                    "/@",
                    "uc1"
                   }
                  ],
                  ",",
                  "False"
                 }
                ],
                "]"
               }
              ],
              ",",
              RowBox[
               {
                RowBox[{"cL", "[", "x__", "]"}],
                ":>",
                RowBox[{"cL", "[", "x", "]"}]
               }
              ],
              ",",
              RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
             }
            ],
            "]"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "DeleteDuplicates",
          "@",
          RowBox[
           {
            "Cases",
            "[",
            RowBox[
             {
              RowBox[
               {
                "Pick",
                "[",
                RowBox[
                 {
                  "uc2",
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                      "&"
                     }
                    ],
                    "/@",
                    "uc2"
                   }
                  ],
                  ",",
                  "False"
                 }
                ],
                "]"
               }
              ],
              ",",
              RowBox[
               {
                RowBox[{"cL", "[", "x__", "]"}],
                ":>",
                RowBox[{"cL", "[", "x", "]"}]
               }
              ],
              ",",
              RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
             }
            ],
            "]"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "DeleteDuplicates",
          "@",
          RowBox[
           {
            "Cases",
            "[",
            RowBox[
             {
              RowBox[
               {
                "Pick",
                "[",
                RowBox[
                 {
                  "uc3",
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                      "&"
                     }
                    ],
                    "/@",
                    "uc3"
                   }
                  ],
                  ",",
                  "False"
                 }
                ],
                "]"
               }
              ],
              ",",
              RowBox[
               {
                RowBox[{"cL", "[", "x__", "]"}],
                ":>",
                RowBox[{"cL", "[", "x", "]"}]
               }
              ],
              ",",
              RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
             }
            ],
            "]"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "DeleteDuplicates",
          "@",
          RowBox[
           {
            "Cases",
            "[",
            RowBox[
             {
              RowBox[
               {
                "Pick",
                "[",
                RowBox[
                 {
                  "uc4",
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                      "&"
                     }
                    ],
                    "/@",
                    "uc4"
                   }
                  ],
                  ",",
                  "False"
                 }
                ],
                "]"
               }
              ],
              ",",
              RowBox[
               {
                RowBox[{"cL", "[", "x__", "]"}],
                ":>",
                RowBox[{"cL", "[", "x", "]"}]
               }
              ],
              ",",
              RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
             }
            ],
            "]"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "uc1N",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    "UncondCov",
                    "[",
                    RowBox[{RowBox[{"dc", "[", "t", "]"}], ",", "#"}],
                    "]"
                   }
                  ],
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "uc2N",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    "UncondCov",
                    "[",
                    RowBox[
                     {
                      RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
                      ",",
                      "#"
                     }
                    ],
                    "]"
                   }
                  ],
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "uc3N",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    "UncondCov",
                    "[",
                    RowBox[
                     {
                      RowBox[{"bondret", "[", RowBox[{"t", ",", "1"}], "]"}],
                      ",",
                      "#"
                     }
                    ],
                    "]"
                   }
                  ],
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "uc4N",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    "UncondCov",
                    "[",
                    RowBox[{RowBox[{"nomsdf", "[", "t", "]"}], ",", "#"}],
                    "]"
                   }
                  ],
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            "allVars"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "p1",
            "=",
            RowBox[
             {
              "Complement",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Thread",
                  "[",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {"Range", "[", RowBox[{"Length", "[", "c1", "]"}], "]"}
                    ],
                    "}"
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                RowBox[
                 {"Position", "[", RowBox[{"c1", ",", "0", ",", "1"}], "]"}
                ]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "ucc1",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "UncondCorr",
                "[",
                RowBox[
                 {RowBox[{"dc", "[", "t", "]"}], ",", "#", ",", "model"}
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            RowBox[
             {"Extract", "[", RowBox[{"allVars", ",", "p1"}], "]"}
            ]
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "ucc2",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "UncondCorr",
                "[",
                RowBox[
                 {
                  RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
                  ",",
                  "#",
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            RowBox[
             {"Extract", "[", RowBox[{"allVars", ",", "p1"}], "]"}
            ]
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "ucc3",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "UncondCorr",
                "[",
                RowBox[
                 {
                  RowBox[{"bondret", "[", RowBox[{"t", ",", "1"}], "]"}],
                  ",",
                  "#",
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            RowBox[
             {"Extract", "[", RowBox[{"allVars", ",", "p1"}], "]"}
            ]
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "ucc4",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "UncondCorr",
                "[",
                RowBox[
                 {RowBox[{"nomsdf", "[", "t", "]"}], ",", "#", ",", "model"}
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            RowBox[
             {"Extract", "[", RowBox[{"allVars", ",", "p1"}], "]"}
            ]
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "DeleteDuplicates",
          "@",
          RowBox[
           {
            "Cases",
            "[",
            RowBox[
             {
              RowBox[
               {
                "Pick",
                "[",
                RowBox[
                 {
                  "ucc1",
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                      "&"
                     }
                    ],
                    "/@",
                    "ucc1"
                   }
                  ],
                  ",",
                  "False"
                 }
                ],
                "]"
               }
              ],
              ",",
              RowBox[
               {
                RowBox[{"cL", "[", "x__", "]"}],
                ":>",
                RowBox[{"cL", "[", "x", "]"}]
               }
              ],
              ",",
              RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
             }
            ],
            "]"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "DeleteDuplicates",
          "@",
          RowBox[
           {
            "Cases",
            "[",
            RowBox[
             {
              RowBox[
               {
                "Pick",
                "[",
                RowBox[
                 {
                  "ucc2",
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                      "&"
                     }
                    ],
                    "/@",
                    "ucc2"
                   }
                  ],
                  ",",
                  "False"
                 }
                ],
                "]"
               }
              ],
              ",",
              RowBox[
               {
                RowBox[{"cL", "[", "x__", "]"}],
                ":>",
                RowBox[{"cL", "[", "x", "]"}]
               }
              ],
              ",",
              RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
             }
            ],
            "]"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "DeleteDuplicates",
          "@",
          RowBox[
           {
            "Cases",
            "[",
            RowBox[
             {
              RowBox[
               {
                "Pick",
                "[",
                RowBox[
                 {
                  "ucc3",
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                      "&"
                     }
                    ],
                    "/@",
                    "ucc3"
                   }
                  ],
                  ",",
                  "False"
                 }
                ],
                "]"
               }
              ],
              ",",
              RowBox[
               {
                RowBox[{"cL", "[", "x__", "]"}],
                ":>",
                RowBox[{"cL", "[", "x", "]"}]
               }
              ],
              ",",
              RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
             }
            ],
            "]"
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "DeleteDuplicates",
          "@",
          RowBox[
           {
            "Cases",
            "[",
            RowBox[
             {
              RowBox[
               {
                "Pick",
                "[",
                RowBox[
                 {
                  "ucc4",
                  ",",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[{"FreeQ", "[", RowBox[{"#", ",", "cL"}], "]"}],
                      "&"
                     }
                    ],
                    "/@",
                    "ucc4"
                   }
                  ],
                  ",",
                  "False"
                 }
                ],
                "]"
               }
              ],
              ",",
              RowBox[
               {
                RowBox[{"cL", "[", "x__", "]"}],
                ":>",
                RowBox[{"cL", "[", "x", "]"}]
               }
              ],
              ",",
              RowBox[{"{", RowBox[{"0", ",", "Infinity"}], "}"}]
             }
            ],
            "]"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "p1num",
            "=",
            RowBox[
             {
              "Complement",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Thread",
                  "[",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {"Range", "[", RowBox[{"Length", "[", "c1num", "]"}], "]"}
                    ],
                    "}"
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                RowBox[
                 {
                  "Position",
                  "[",
                  RowBox[{"c1num", ",", "0", ",", "1"}],
                  "]"
                 }
                ]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "ucc1N",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    "UncondCorr",
                    "[",
                    RowBox[{RowBox[{"dc", "[", "t", "]"}], ",", "#"}],
                    "]"
                   }
                  ],
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            RowBox[
             {"Extract", "[", RowBox[{"allVars", ",", "p1num"}], "]"}
            ]
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "ucc2N",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    "UncondCorr",
                    "[",
                    RowBox[
                     {
                      RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
                      ",",
                      "#"
                     }
                    ],
                    "]"
                   }
                  ],
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            RowBox[
             {"Extract", "[", RowBox[{"allVars", ",", "p1num"}], "]"}
            ]
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "ucc3N",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    "UncondCorr",
                    "[",
                    RowBox[
                     {
                      RowBox[{"bondret", "[", RowBox[{"t", ",", "1"}], "]"}],
                      ",",
                      "#"
                     }
                    ],
                    "]"
                   }
                  ],
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            RowBox[
             {"Extract", "[", RowBox[{"allVars", ",", "p1num"}], "]"}
            ]
           }
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "ucc4N",
          "=",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                "ToNum",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    "UncondCorr",
                    "[",
                    RowBox[{RowBox[{"nomsdf", "[", "t", "]"}], ",", "#"}],
                    "]"
                   }
                  ],
                  ",",
                  "model"
                 }
                ],
                "]"
               }
              ],
              "&"
             }
            ],
            "/@",
            RowBox[
             {"Extract", "[", RowBox[{"allVars", ",", "p1num"}], "]"}
            ]
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                RowBox[
                 {
                  "Ev",
                  "[",
                  RowBox[{"#", ",", RowBox[{"t", "-", "1"}], ",", "model"}],
                  "]"
                 }
                ],
                "&"
               }
              ],
              "/@",
              "allVars"
             }
            ],
            "//",
            "Simplify"
           }
          ],
          "//",
          "TableForm"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                RowBox[
                 {
                  "ToNum",
                  "[",
                  RowBox[
                   {
                    RowBox[
                     {
                      "Ev",
                      "[",
                      RowBox[{"#", ",", RowBox[{"t", "-", "1"}]}],
                      "]"
                     }
                    ],
                    ",",
                    "model"
                   }
                  ],
                  "]"
                 }
                ],
                "&"
               }
              ],
              "/@",
              "allVars"
             }
            ],
            "//",
            "Simplify"
           }
          ],
          "//",
          "TableForm"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "c2",
         "=",
         RowBox[
          {
           RowBox[
            {
             RowBox[
              {
               RowBox[
                {
                 "Var",
                 "[",
                 RowBox[{"#", ",", RowBox[{"t", "-", "1"}], ",", "model"}],
                 "]"
                }
               ],
               "&"
              }
             ],
             "/@",
             "allVars"
            }
           ],
           "//",
           "Simplify"
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "c2num",
         "=",
         RowBox[
          {
           RowBox[
            {
             RowBox[
              {
               RowBox[
                {
                 "ToNum",
                 "[",
                 RowBox[
                  {
                   RowBox[
                    {
                     "Var",
                     "[",
                     RowBox[{"#", ",", RowBox[{"t", "-", "1"}]}],
                     "]"
                    }
                   ],
                   ",",
                   "model"
                  }
                 ],
                 "]"
                }
               ],
               "&"
              }
             ],
             "/@",
             "allVars"
            }
           ],
           "//",
           "Simplify"
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Cov",
              "[",
              RowBox[
               {
                RowBox[{"dc", "[", "t", "]"}],
                ",",
                "#",
                ",",
                RowBox[{"t", "-", "1"}],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Cov",
              "[",
              RowBox[
               {
                RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
                ",",
                "#",
                ",",
                RowBox[{"t", "-", "1"}],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Cov",
              "[",
              RowBox[
               {
                RowBox[{"bondret", "[", RowBox[{"t", ",", "1"}], "]"}],
                ",",
                "#",
                ",",
                RowBox[{"t", "-", "1"}],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Cov",
              "[",
              RowBox[
               {
                RowBox[{"nomsdf", "[", "t", "]"}],
                ",",
                "#",
                ",",
                RowBox[{"t", "-", "1"}],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "p2",
            "=",
            RowBox[
             {
              "Complement",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Thread",
                  "[",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {"Range", "[", RowBox[{"Length", "[", "c2", "]"}], "]"}
                    ],
                    "}"
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                RowBox[
                 {"Position", "[", RowBox[{"c2", ",", "0", ",", "1"}], "]"}
                ]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Corr",
              "[",
              RowBox[
               {
                RowBox[{"dc", "[", "t", "]"}],
                ",",
                "#",
                ",",
                RowBox[{"t", "-", "1"}],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          RowBox[
           {"Extract", "[", RowBox[{"allVars", ",", "p2"}], "]"}
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Corr",
              "[",
              RowBox[
               {
                RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
                ",",
                "#",
                ",",
                RowBox[{"t", "-", "1"}],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          RowBox[
           {"Extract", "[", RowBox[{"allVars", ",", "p2"}], "]"}
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Corr",
              "[",
              RowBox[
               {
                RowBox[{"bondret", "[", RowBox[{"t", ",", "1"}], "]"}],
                ",",
                "#",
                ",",
                RowBox[{"t", "-", "1"}],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          RowBox[
           {"Extract", "[", RowBox[{"allVars", ",", "p2"}], "]"}
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "Corr",
              "[",
              RowBox[
               {
                RowBox[{"nomsdf", "[", "t", "]"}],
                ",",
                "#",
                ",",
                RowBox[{"t", "-", "1"}],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          RowBox[
           {"Extract", "[", RowBox[{"allVars", ",", "p2"}], "]"}
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Cov",
                  "[",
                  RowBox[
                   {
                    RowBox[{"dc", "[", "t", "]"}],
                    ",",
                    "#",
                    ",",
                    RowBox[{"t", "-", "1"}]
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Cov",
                  "[",
                  RowBox[
                   {
                    RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
                    ",",
                    "#",
                    ",",
                    RowBox[{"t", "-", "1"}]
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Cov",
                  "[",
                  RowBox[
                   {
                    RowBox[{"bondret", "[", RowBox[{"t", ",", "1"}], "]"}],
                    ",",
                    "#",
                    ",",
                    RowBox[{"t", "-", "1"}]
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Cov",
                  "[",
                  RowBox[
                   {
                    RowBox[
                     {
                      "bondret",
                      "[",
                      RowBox[{RowBox[{"t", "+", "1"}], ",", "1"}],
                      "]"
                     }
                    ],
                    ",",
                    "#",
                    ",",
                    RowBox[{"t", "-", "1"}]
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Cov",
                  "[",
                  RowBox[
                   {
                    RowBox[{"nomsdf", "[", "t", "]"}],
                    ",",
                    "#",
                    ",",
                    RowBox[{"t", "-", "1"}]
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          "allVars"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "p2num",
            "=",
            RowBox[
             {
              "Complement",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Thread",
                  "[",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {"Range", "[", RowBox[{"Length", "[", "c2num", "]"}], "]"}
                    ],
                    "}"
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                RowBox[
                 {
                  "Position",
                  "[",
                  RowBox[{"c2num", ",", "0", ",", "1"}],
                  "]"
                 }
                ]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Corr",
                  "[",
                  RowBox[
                   {
                    RowBox[{"dc", "[", "t", "]"}],
                    ",",
                    "#",
                    ",",
                    RowBox[{"t", "-", "1"}]
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          RowBox[
           {"Extract", "[", RowBox[{"allVars", ",", "p2num"}], "]"}
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Corr",
                  "[",
                  RowBox[
                   {
                    RowBox[{"ret", "[", RowBox[{"t", ",", "1"}], "]"}],
                    ",",
                    "#",
                    ",",
                    RowBox[{"t", "-", "1"}]
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          RowBox[
           {"Extract", "[", RowBox[{"allVars", ",", "p2num"}], "]"}
          ]
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "ToNum",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  "Corr",
                  "[",
                  RowBox[
                   {
                    RowBox[{"nomsdf", "[", "t", "]"}],
                    ",",
                    "#",
                    ",",
                    RowBox[{"t", "-", "1"}]
                   }
                  ],
                  "]"
                 }
                ],
                ",",
                "model"
               }
              ],
              "]"
             }
            ],
            "&"
           }
          ],
          "/@",
          RowBox[
           {"Extract", "[", RowBox[{"allVars", ",", "p2num"}], "]"}
          ]
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondCov",
         "[",
         RowBox[
          {
           SuperscriptBox[
            RowBox[{"sg", "[", RowBox[{"t", "-", "1"}], "]"}],
            "2"
           ],
           ",",
           RowBox[{"x", "[", "t", "]"}],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondCov",
         "[",
         RowBox[
          {
           RowBox[{"ret", "[", RowBox[{"t", ",", "i"}], "]"}],
           ",",
           RowBox[{"pibar", "[", "t", "]"}],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         RowBox[{RowBox[{"wc", "[", "t", "]"}], ",", "model"}],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "ToExogenousVars",
         "[",
         RowBox[{RowBox[{"wc", "[", "t", "]"}], ",", "model"}],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "ToEquation",
         "[",
         RowBox[{RowBox[{"wc", "[", "t", "]"}], ",", "model"}],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         RowBox[
          {
           RowBox[
            {
             RowBox[
              {RowBox[{"eps", "[", "\"pi\"", "]"}], "[", "t", "]"}
             ],
             " ",
             RowBox[
              {
               "(",
               RowBox[
                {
                 "Esg",
                 "+",
                 RowBox[
                  {
                   "rhog",
                   " ",
                   RowBox[
                    {
                     "(",
                     RowBox[
                      {
                       RowBox[{"-", "Esg"}],
                       "+",
                       RowBox[
                        {"sg", "[", RowBox[{RowBox[{"-", "2"}], "+", "t"}], "]"}
                       ]
                      }
                     ],
                     ")"
                    }
                   ]
                  }
                 ],
                 "+",
                 RowBox[
                  {
                   "phig",
                   " ",
                   RowBox[
                    {
                     RowBox[{"eps", "[", "\"sg\"", "]"}],
                     "[",
                     RowBox[{RowBox[{"-", "1"}], "+", "t"}],
                     "]"
                    }
                   ]
                  }
                 ]
                }
               ],
               ")"
              }
             ]
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         RowBox[
          {
           RowBox[
            {
             RowBox[
              {RowBox[{"eps", "[", "\"pi\"", "]"}], "[", "t", "]"}
             ],
             " ",
             "Esg"
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         RowBox[
          {
           RowBox[
            {
             RowBox[
              {RowBox[{"eps", "[", "\"pi\"", "]"}], "[", "t", "]"}
             ],
             " ",
             RowBox[
              {"sg", "[", RowBox[{RowBox[{"-", "2"}], "+", "t"}], "]"}
             ]
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         RowBox[
          {
           RowBox[
            {
             RowBox[
              {RowBox[{"eps", "[", "\"pi\"", "]"}], "[", "t", "]"}
             ],
             " ",
             RowBox[
              {
               RowBox[{"eps", "[", "\"sg\"", "]"}],
               "[",
               RowBox[{RowBox[{"-", "1"}], "+", "t"}],
               "]"
              }
             ]
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         RowBox[
          {
           RowBox[
            {
             RowBox[
              {"sg", "[", RowBox[{RowBox[{"-", "1"}], "+", "t"}], "]"}
             ],
             " ",
             RowBox[
              {RowBox[{"eps", "[", "\"sg\"", "]"}], "[", "t", "]"}
             ]
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         " ",
         RowBox[
          {
           RowBox[
            {
             SuperscriptBox[
              RowBox[
               {RowBox[{"eps", "[", "\"sg\"", "]"}], "[", "t", "]"}
              ],
              "2"
             ],
             "+",
             RowBox[
              {"sg", "[", RowBox[{RowBox[{"-", "1"}], "+", "t"}], "]"}
             ]
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         RowBox[
          {
           RowBox[
            {
             SuperscriptBox["Esg", "2"],
             "-",
             RowBox[{"2", " ", SuperscriptBox["Esg", "2"], " ", "rhog"}],
             "+",
             RowBox[
              {
               SuperscriptBox["Esg", "2"],
               " ",
               SuperscriptBox["rhog", "2"]
              }
             ],
             "+",
             RowBox[
              {
               "2",
               " ",
               "Esg",
               " ",
               "rhog",
               " ",
               RowBox[
                {"sg", "[", RowBox[{RowBox[{"-", "1"}], "+", "t"}], "]"}
               ]
              }
             ],
             "-",
             RowBox[
              {
               "2",
               " ",
               "Esg",
               " ",
               SuperscriptBox["rhog", "2"],
               " ",
               RowBox[
                {"sg", "[", RowBox[{RowBox[{"-", "1"}], "+", "t"}], "]"}
               ]
              }
             ],
             "+",
             RowBox[
              {
               SuperscriptBox["rhog", "2"],
               " ",
               SuperscriptBox[
                RowBox[
                 {"sg", "[", RowBox[{RowBox[{"-", "1"}], "+", "t"}], "]"}
                ],
                "2"
               ]
              }
             ]
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "FernandoDuarte`LongRunRisk`ComputationalEngine`ComputeUnconditionalExpectations`uncondVar",
         "[",
         " ",
         RowBox[
          {
           RowBox[
            {
             SuperscriptBox[
              RowBox[
               {RowBox[{"eps", "[", "\"sg\"", "]"}], "[", "t", "]"}
              ],
              "2"
             ],
             "+",
             RowBox[
              {"sg", "[", RowBox[{RowBox[{"-", "1"}], "+", "t"}], "]"}
             ]
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "FernandoDuarte`LongRunRisk`ComputationalEngine`ComputeUnconditionalExpectations`uncondCov",
         "[",
         " ",
         RowBox[
          {
           SuperscriptBox[
            RowBox[
             {"sg", "[", RowBox[{RowBox[{"-", "1"}], "+", "t"}], "]"}
            ],
            "2"
           ],
           ",",
           RowBox[{"pi", "[", "t", "]"}],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondCov",
         "[",
         RowBox[
          {
           RowBox[{RowBox[{"eps", "[", "\"x\"", "]"}], "[", "t", "]"}],
           ",",
           RowBox[
            {RowBox[{"eps", "[", "\"dc\"", "]"}], "[", "t", "]"}
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "UncondVar",
         "[",
         RowBox[{RowBox[{"eps", "[", "\"x\"", "]"}], ",", "model"}],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          "UncondCov",
          "[",
          RowBox[
           {
            RowBox[
             {
              RowBox[
               {
                RowBox[{"eps", "[", "\"dd\"", "]"}],
                "[",
                RowBox[{"t", ",", "i"}],
                "]"
               }
              ],
              RowBox[
               {
                RowBox[{"eps", "[", "\"dd\"", "]"}],
                "[",
                RowBox[{"t", ",", "i"}],
                "]"
               }
              ]
             }
            ],
            ",",
            RowBox[
             {
              RowBox[
               {RowBox[{"eps", "[", "\"dc\"", "]"}], "[", "t", "]"}
              ],
              RowBox[
               {RowBox[{"eps", "[", "\"dc\"", "]"}], "[", "t", "]"}
              ]
             }
            ],
            ",",
            "model"
           }
          ],
          "]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "UncondCov",
          "[",
          RowBox[
           {
            RowBox[
             {RowBox[{"eps", "[", "\"dc\"", "]"}], "[", "t", "]"}
            ],
            ",",
            RowBox[
             {
              RowBox[{"eps", "[", "\"dd\"", "]"}],
              "[",
              RowBox[{"t", ",", "i"}],
              "]"
             }
            ],
            ",",
            "model"
           }
          ],
          "]"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "modelEval",
         "[",
         RowBox[
          {
           RowBox[
            {
             "UncondCov",
             "[",
             RowBox[
              {
               RowBox[{"wc", "[", "t", "]"}],
               ",",
               RowBox[{"wc", "[", "t", "]"}]
              }
             ],
             "]"
            }
           ],
           ",",
           "model"
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "-",
              SuperscriptBox[
               "FernandoDuarte`LongRunRisk`Model`Parameters`Esx",
               "2"
              ]
             }
            ],
            " ",
            "FernandoDuarte`LongRunRisk`Model`Parameters`phipbarx",
            " ",
            "FernandoDuarte`LongRunRisk`Model`Parameters`phix",
            " ",
            RowBox[
             {
              "(",
              RowBox[
               {
                RowBox[{"-", "1"}],
                "+",
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                 "2"
                ]
               }
              ],
              ")"
             }
            ]
           }
          ],
          " ",
          "\[IndentingNewLine]",
          "\[IndentingNewLine]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "(",
            RowBox[
             {
              RowBox[
               {
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                 "8"
                ],
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    RowBox[{"-", "1"}],
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ],
              "+",
              RowBox[
               {
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                 "7"
                ],
                " ",
                "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    RowBox[{"-", "1"}],
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ],
              "+",
              RowBox[
               {
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                 "6"
                ],
                " ",
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                 "2"
                ],
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    RowBox[{"-", "1"}],
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ],
              "+",
              RowBox[
               {
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                 "5"
                ],
                " ",
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                 "3"
                ],
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    RowBox[{"-", "1"}],
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ],
              "+",
              RowBox[
               {
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                 "4"
                ],
                " ",
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                 "4"
                ],
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    RowBox[{"-", "1"}],
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ],
              "+",
              RowBox[
               {
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                 "3"
                ],
                " ",
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                 "5"
                ],
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    RowBox[{"-", "1"}],
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ],
              "+",
              RowBox[
               {
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                 "2"
                ],
                " ",
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                 "6"
                ],
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    RowBox[{"-", "1"}],
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ],
              "+",
              RowBox[
               {
                "FernandoDuarte`LongRunRisk`Model`Parameters`rhopbar",
                " ",
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                 "7"
                ],
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    RowBox[{"-", "1"}],
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ],
              "-",
              RowBox[
               {
                SuperscriptBox[
                 "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                 "8"
                ],
                " ",
                RowBox[
                 {
                  "(",
                  RowBox[
                   {
                    "1",
                    "+",
                    SuperscriptBox[
                     "FernandoDuarte`LongRunRisk`Model`Parameters`rhox",
                     "2"
                    ]
                   }
                  ],
                  ")"
                 }
                ]
               }
              ]
             }
            ],
            ")"
           }
          ],
          " ",
          "\[IndentingNewLine]",
          "\[IndentingNewLine]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          "FernandoDuarte`LongRunRisk`Model`Parameters`rhoxpbar",
          " ",
          RowBox[
           {
            "FernandoDuarte`LongRunRisk`Model`Parameters`rhodx",
            "[",
            "j",
            "]"
           }
          ],
          " ",
          RowBox[
           {
            "FernandoDuarte`LongRunRisk`Model`Parameters`rhodx",
            "[",
            "k",
            "]"
           }
          ]
         }
        ]
       }
      ],
      "Input"
     ]
    },
    Open
   ]
  ]
 },
 WindowSize -> {1715, 942},
 WindowMargins -> {{Automatic, -1804}, {Automatic, 0}},
 WindowStatusArea -> "",
 TaggingRules -> <|"TryRealOnly" -> False|>,
 Magnification :> 1.25 * Inherited,
 FrontEndVersion -> "13.3 for Mac OS X ARM (64-bit) (July 24, 2023)",
 StyleDefinitions -> "Default.nb",
 ExpressionUUID -> "28726991-7989-40ff-90db-b85d56c7a0a9"
]