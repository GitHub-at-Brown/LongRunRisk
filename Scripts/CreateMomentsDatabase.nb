(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[     29818,        698]
NotebookOptionsPosition[     26209,        639]
NotebookOutlinePosition[     26697,        658]
CellTagsIndexPosition[     26654,        655]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"numKernels", "=", "8"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Unprotect", "[", "$ProcessorCount", "]"}], ";", 
  RowBox[{"$ProcessorCount", "=", "numKernels"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CloseKernels", "[", "]"}], ";", 
  RowBox[{"LaunchKernels", "[", "numKernels", "]"}], ";", 
  RowBox[{"Kernels", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.906300513984253*^9, 3.9063005139862823`*^9}, {
   3.906303109453136*^9, 3.906303142642474*^9}, {3.906303942265872*^9, 
   3.906303942901717*^9}, {3.906317684466033*^9, 3.906317685646792*^9}, 
   3.9076066326925793`*^9, 3.907898150358786*^9, {3.908611974086266*^9, 
   3.908611987280716*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"dc40f7be-969b-473a-9eef-1c4242fca6f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"test", " ", "parallel", " ", "kernels", " ", "work"}], ",", 
    RowBox[{
    "line", " ", "with", " ", "ParallelSum", " ", "should", " ", "execute", 
     " ", "faster", " ", "than", " ", "line", " ", "with", " ", "Sum"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"n", "-", 
          RowBox[{"Total", "[", 
           RowBox[{"IntegerDigits", "[", 
            RowBox[{"n", ",", "5"}], "]"}], "]"}]}], ")"}], "/", "4"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", 
         RowBox[{"10", "^", "3"}], ",", 
         RowBox[{"10", "^", "7"}]}], "}"}]}], "]"}], "//", 
     RowBox[{"AbsoluteTiming", "\n", 
      RowBox[{"ParallelSum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", 
           RowBox[{"Total", "[", 
            RowBox[{"IntegerDigits", "[", 
             RowBox[{"n", ",", "5"}], "]"}], "]"}]}], ")"}], "/", "4"}], ",", 
        
        RowBox[{"{", 
         RowBox[{"n", ",", 
          RowBox[{"10", "^", "3"}], ",", 
          RowBox[{"10", "^", "7"}]}], "}"}]}], "]"}]}]}], "//", 
    "AbsoluteTiming"}], "\[IndentingNewLine]", "*)"}]}]], "Input",
 CellChangeTimes->{{3.906300553722005*^9, 3.906300553724126*^9}, {
  3.906303286683433*^9, 3.906303349862402*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"a4362e4c-3422-4c94-ab26-d50864964ce4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"thisFileName", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"DirectoryName", "[", 
       RowBox[{
        RowBox[{"NotebookDirectory", "[", "]"}], ",", "1"}], "]"}], ",", 
      RowBox[{
       RowBox[{"FileBaseName", "[", 
        RowBox[{"NotebookFileName", "[", "]"}], "]"}], "<>", 
       "\"\<.wlt\>\""}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"thisFileBase", "=", 
   RowBox[{"FileBaseName", "[", "thisFileName", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pacletDir", "=", 
   RowBox[{"DirectoryName", "[", 
    RowBox[{"thisFileName", ",", "1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"resourcesDir", "=", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{"pacletDir", ",", "\"\<Resources\>\""}], "}"}], "]"}]}]}], "Input",\

 CellChangeTimes->{{3.8890661685133457`*^9, 3.889066220685074*^9}, {
   3.8890662555512333`*^9, 3.889066299901951*^9}, {3.889066581166473*^9, 
   3.8890665847967653`*^9}, {3.889066731765956*^9, 3.889066745674687*^9}, {
   3.889431410824514*^9, 3.88943144002302*^9}, 3.889502968269744*^9, {
   3.889998928469849*^9, 3.889998928670561*^9}, {3.890676553021196*^9, 
   3.890676564028514*^9}, 3.890676636594749*^9, {3.890679618620262*^9, 
   3.89067961902995*^9}, {3.8908254134370813`*^9, 3.890825413876319*^9}, {
   3.890825459205497*^9, 3.890825473041605*^9}, {3.890825503118348*^9, 
   3.8908255374530487`*^9}, {3.891021675325671*^9, 3.891021675545487*^9}, {
   3.8911588731924877`*^9, 3.891158877904397*^9}, {3.8911592499395514`*^9, 
   3.8911592502376633`*^9}, {3.891244075958187*^9, 3.891244079885818*^9}, 
   3.891274440015959*^9, 3.891913898993636*^9, {3.893083620043439*^9, 
   3.893083620908062*^9}, {3.895490302188603*^9, 3.895490303315134*^9}, {
   3.895555277801629*^9, 3.895555292190344*^9}, {3.8955553434770117`*^9, 
   3.895555387252871*^9}, {3.895555428812483*^9, 3.895555436948851*^9}, 
   3.895555470825795*^9, {3.895555969261059*^9, 3.895555975355225*^9}, {
   3.8955566274456863`*^9, 3.895556658648676*^9}, {3.895690597340239*^9, 
   3.895690598249178*^9}, {3.906306710892268*^9, 3.906306713573086*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"3678a217-ed8d-42c6-86a2-75c1ea1115fd"],

Cell[CellGroupData[{

Cell["Build database", "Subsection",
 CellChangeTimes->{{3.889905622471089*^9, 3.889905629759961*^9}, {
  3.889972063478182*^9, 3.889972065236586*^9}, {3.895555245059051*^9, 
  3.895555248658716*^9}},ExpressionUUID->"d03dfeba-2718-41c7-9b3f-\
19ce5bed64e2"],

Cell[BoxData[{
 RowBox[{"Get", "@", 
  RowBox[{"Get", "[", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{"resourcesDir", ",", "\"\<Models.wl\>\""}], "}"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Get", "@", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{
    "pacletDir", ",", "\"\<Kernel\>\"", ",", "\"\<ComputationalEngine\>\"", 
     ",", 
     RowBox[{"thisFileBase", "<>", "\"\<.wl\>\""}]}], "}"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{3.906317737454419*^9},
 CellLabel->"In[9]:=",ExpressionUUID->"4ed5f578-352d-450a-80c3-862d7bf99a10"],

Cell[BoxData[
 RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Do", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"fileName", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"resourcesDir", ",", "\"\<MomentsLookupTables\>\"", ",", 
          RowBox[{"\"\<covLong\>\"", "<>", "key", "<>", "\"\<.wl\>\""}]}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"FileExistsQ", "[", "fileName", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"CreateFile", "[", "fileName", "]"}]}], "\[IndentingNewLine]",
        "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"createDatabase", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"FernandoDuarte`LongRunRisk`Models", "[", "key", "]"}], ",", 
        "\n", "\t", "fileName"}], "\[IndentingNewLine]", "]"}], ";"}], 
     "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"key", ",", 
       RowBox[{"{", "\"\<NRCStochVol\>\"", "}"}]}], 
      RowBox[{"(*", 
       RowBox[{"Keys", "@", "FernandoDuarte`LongRunRisk`Models"}], "*)"}], 
      "}"}]}], "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.895690863697507*^9, 3.895690864733301*^9}, {
   3.906018938077572*^9, 3.906018941772141*^9}, {3.906018977073923*^9, 
   3.906018978550452*^9}, {3.906304388728945*^9, 3.906304402078619*^9}, {
   3.906306256172038*^9, 3.906306325560347*^9}, 3.906315332686532*^9, 
   3.906317694367881*^9, {3.906317756579115*^9, 3.906317766982209*^9}, {
   3.907524780243581*^9, 3.907524781457612*^9}, {3.90760664889235*^9, 
   3.907606653505204*^9}, {3.908612041759028*^9, 3.9086120892711*^9}, {
   3.908651523233869*^9, 3.908651526384704*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"5ea9f70b-0b8c-459e-9ee8-7dc6c6672ae0"],

Cell[BoxData[
 RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Do", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"fileName", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"resourcesDir", ",", "\"\<MomentsLookupTables\>\"", ",", 
          RowBox[{"\"\<covLong\>\"", "<>", "key", "<>", "\"\<.wl\>\""}]}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"FileExistsQ", "[", "fileName", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"CreateFile", "[", "fileName", "]"}]}], "\[IndentingNewLine]",
        "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"createDatabase", "[", "\n", "\t", 
       RowBox[{
        RowBox[{"FernandoDuarte`LongRunRisk`Models", "[", "key", "]"}], ",", 
        "\n", "\t", "fileName"}], "\[IndentingNewLine]", "]"}], ";"}], 
     "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"key", ",", 
       RowBox[{"{", "\"\<NRCStochVol\>\"", "}"}]}], 
      RowBox[{"(*", 
       RowBox[{"Keys", "@", "FernandoDuarte`LongRunRisk`Models"}], "*)"}], 
      "}"}]}], "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "]"}]], "Input",ExpressionUUID->"fa946b96-4c46-453b-9b83-aba8a5e92fb0"],

Cell[BoxData[{
 RowBox[{"{", 
  RowBox[{"\"\<NRC\>\"", ",", "\"\<DES\>\"", ",", "\"\<NRCStochVol\>\""}], 
  "}"}], "\[IndentingNewLine]", 
 RowBox[{"time", "=", 
  RowBox[{"{", 
   RowBox[{"49773.782447`", ",", "Null"}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.906370100888014*^9, 
  3.906370102402113*^9}},ExpressionUUID->"61669275-a1f5-4d34-958c-\
9291cd439be9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BKYtime", "=", 
   RowBox[{"{", 
    RowBox[{"4785.605649`", ",", "Null"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.906317714769443*^9, 
  3.906317718757083*^9}},ExpressionUUID->"56dedefd-27bf-4f07-9d08-\
49c2fa5e8972"],

Cell[BoxData[
 RowBox[{"NRCStochVoltime", "=", 
  RowBox[{"{", 
   RowBox[{"345088.066629", ",", "Null"}], "}"}]}]], "Input",
 CellChangeTimes->{{3.908109698429634*^9, 
  3.90810970679663*^9}},ExpressionUUID->"e14e5b59-e33d-44d7-813b-\
11c902dee319"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"345088", "/", "60"}], "/", "60"}], "/", "24"}], "//", 
  "N"}]], "Input",
 CellChangeTimes->{{3.908109712434019*^9, 3.908109722830162*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"fefa24fc-c058-41d1-b49c-bb6e9a2999ce"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Load and test", "Subsection",
 CellChangeTimes->{{3.895668123084955*^9, 3.895668129710462*^9}, {
  3.895670347636486*^9, 
  3.895670351021296*^9}},ExpressionUUID->"6b918d18-7704-45dd-b222-\
55d8d234ce9f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Quit", "[", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.895668130981999*^9, 3.895668133141368*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"456aea83-3b17-4426-af60-5b58a2a0573c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"thisFileName", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"DirectoryName", "[", 
       RowBox[{
        RowBox[{"NotebookDirectory", "[", "]"}], ",", "1"}], "]"}], ",", 
      RowBox[{
       RowBox[{"FileBaseName", "[", 
        RowBox[{"NotebookFileName", "[", "]"}], "]"}], "<>", 
       "\"\<.wlt\>\""}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"thisFileBase", "=", 
   RowBox[{"FileBaseName", "[", "thisFileName", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pacletDir", "=", 
   RowBox[{"DirectoryName", "[", 
    RowBox[{"thisFileName", ",", "1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"resourcesDir", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{"pacletDir", ",", "\"\<Resources\>\""}], "}"}], "]"}]}], 
  ";"}]}], "Input",
 CellLabel->"In[1]:=",ExpressionUUID->"1cb52e22-209f-41eb-978c-5c7f5d404f1b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"filenameModels", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{"resourcesDir", ",", "\"\<Models.wl\>\""}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"dataModels", "=", 
  RowBox[{"Get", "[", "filenameModels", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Get", "@", "dataModels"}]}], "Input",
 CellChangeTimes->{{3.894805595213706*^9, 3.894805626435652*^9}, {
   3.894805703062829*^9, 3.894805751713066*^9}, 3.894880868918269*^9, {
   3.8948847961295757`*^9, 3.894884796244917*^9}, 3.8948855760134706`*^9, {
   3.8948867475700483`*^9, 3.8948867717367*^9}, {3.894886966447394*^9, 
   3.8948869698475647`*^9}, {3.8948874148815002`*^9, 3.89488741855857*^9}, {
   3.8956681020776243`*^9, 3.8956681346619*^9}, 3.89567006269088*^9, 
   3.895670269430372*^9, 3.8956703113831663`*^9, {3.895671723583414*^9, 
   3.895671733332727*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"61d39cc5-b370-402a-9f30-d3392e6deb46"],

Cell[BoxData[{
 RowBox[{"Get", "@", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{
    "pacletDir", ",", "\"\<Kernel\>\"", ",", "\"\<ComputationalEngine\>\"", 
     ",", 
     RowBox[{"thisFileBase", "<>", "\"\<.wl\>\""}]}], "}"}], "]"}]}], "\n", 
 RowBox[{"Get", "@", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{
    "pacletDir", ",", "\"\<Kernel\>\"", ",", "\"\<ComputationalEngine\>\"", 
     ",", 
     RowBox[{
     "\"\<ComputeUnconditionalExpectations\>\"", "<>", "\"\<.wl\>\""}]}], 
    "}"}], "]"}]}], "\n", 
 RowBox[{"Get", "@", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{
    "pacletDir", ",", "\"\<Kernel\>\"", ",", "\"\<ComputationalEngine\>\"", 
     ",", 
     RowBox[{
     "\"\<ComputeConditionalExpectations\>\"", "<>", "\"\<.wl\>\""}]}], "}"}],
    "]"}]}]}], "Input",
 CellLabel->"In[9]:=",ExpressionUUID->"47632f64-5dee-462c-9f21-f5a3d49e3d8e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"model", "=", 
   RowBox[{
   "FernandoDuarte`LongRunRisk`Models", "[", "\"\<NRCStochVol\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"modelShortName", "=", 
   RowBox[{"model", "[", "\"\<shortname\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"covLongFilename", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{"resourcesDir", ",", "\"\<MomentsLookupTables\>\"", ",", 
      RowBox[{
      "\"\<covLong\>\"", "<>", "modelShortName", "<>", "\"\<.wl\>\""}]}], 
     "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"covLongFilenameSave", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{"resourcesDir", ",", "\"\<MomentsLookupTables\>\"", ",", 
      RowBox[{
      "\"\<covLong\>\"", "<>", "modelShortName", "<>", "\"\<Save.wl\>\""}]}], 
     "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"toExogenous", " ", "=", " ", 
   RowBox[{"Normal", "@", 
    RowBox[{"model", "[", "\"\<endogenousEq\>\"", "]"}]}]}], ";"}]}], "Input",\

 CellChangeTimes->{{3.8954425507789497`*^9, 3.895442551073287*^9}, {
   3.895442611639639*^9, 3.89544266632174*^9}, {3.895442778509056*^9, 
   3.8954429208181267`*^9}, {3.895443064490199*^9, 3.895443081297099*^9}, 
   3.895443142205739*^9, {3.895443203563892*^9, 3.895443325262887*^9}, 
   3.895444437943017*^9, 3.895444478648745*^9, {3.895444828217681*^9, 
   3.895444830639021*^9}, 3.8954892475566874`*^9, {3.89549033776551*^9, 
   3.895490338380775*^9}, {3.895553164149826*^9, 3.89555318772189*^9}, {
   3.895553473803101*^9, 3.8955534756229057`*^9}, {3.895555509562429*^9, 
   3.895555530846114*^9}, {3.8955556200346746`*^9, 3.895555629912984*^9}, {
   3.895555799970644*^9, 3.895555805139558*^9}, {3.895556721949316*^9, 
   3.895556722536572*^9}, {3.895556803109399*^9, 3.895556803450493*^9}, {
   3.895557076271131*^9, 3.895557076584648*^9}, {3.895669315373522*^9, 
   3.895669315812739*^9}, {3.895691326621079*^9, 3.895691326896227*^9}, {
   3.906024621894751*^9, 3.906024622355446*^9}, {3.908702973123258*^9, 
   3.908702975031557*^9}},
 CellLabel->"In[17]:=",ExpressionUUID->"30f23af8-6038-4069-8243-a8e8072685a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"uncondE", "[", "expr_", "]"}], ":=", 
  RowBox[{"uncondE", "[", 
   RowBox[{"expr", ",", "model"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uncondVar", "[", "expr_", "]"}], ":=", 
  RowBox[{"uncondVar", "[", 
   RowBox[{"expr", ",", "model"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"uncondCov", "[", 
    RowBox[{"expr1_", ",", "expr2_"}], "]"}], ":=", 
   RowBox[{"uncondCov", "[", 
    RowBox[{"expr1", ",", "expr2", ",", "model"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ev", "[", 
   RowBox[{"expr_", ",", "t_"}], "]"}], ":=", 
  RowBox[{"ev", "[", 
   RowBox[{"expr", ",", "t", ",", "model"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"var", "[", 
   RowBox[{"expr_", ",", "t_"}], "]"}], ":=", 
  RowBox[{"var", "[", 
   RowBox[{"expr", ",", "t", ",", "model"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cov", "[", 
    RowBox[{"expr1_", ",", "expr2_", ",", "t_"}], "]"}], ":=", 
   RowBox[{"cov", "[", 
    RowBox[{"expr1", ",", "expr2", ",", "t", ",", "model"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearAll", "[", 
  RowBox[{"uncondCovLong", ",", "uncondVarLong"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uncondCovLong", "[", 
   RowBox[{"expr1_", ",", " ", "expr2_", ",", " ", 
    RowBox[{"covfun_", ":", "covLong"}]}], "]"}], ":=", 
  RowBox[{"uncondCovLongExo", "[", 
   RowBox[{
   "toExogenous", ",", "expr1", ",", " ", "expr2", ",", "  ", "covfun"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uncondVarLong", "[", 
   RowBox[{"expr_", ",", 
    RowBox[{"covfun_", ":", "covLong"}]}], "]"}], ":=", 
  RowBox[{"uncondVarLongExo", "[", 
   RowBox[{"toExogenous", ",", "expr", ",", "  ", "covfun"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8954425507789497`*^9, 3.895442551073287*^9}, {
   3.895442611639639*^9, 3.89544266632174*^9}, {3.895442778509056*^9, 
   3.8954429208181267`*^9}, {3.895443064490199*^9, 3.895443081297099*^9}, 
   3.895443142205739*^9, {3.895443203563892*^9, 3.895443325262887*^9}, 
   3.895444437943017*^9, 3.895444478648745*^9, {3.895444828217681*^9, 
   3.895444830639021*^9}, 3.8954892475566874`*^9, {3.89549033776551*^9, 
   3.895490338380775*^9}, {3.895553164149826*^9, 3.89555318772189*^9}, {
   3.895553473803101*^9, 3.8955534756229057`*^9}, {3.895555509562429*^9, 
   3.895555530846114*^9}},
 CellLabel->"In[22]:=",ExpressionUUID->"2888b875-28ee-4f08-b551-05df1c125f41"],

Cell[BoxData[{
 RowBox[{"dataCovLong", "=", 
  RowBox[{"Get", "[", "covLongFilename", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Get", "@", "dataCovLong"}]}], "Input",
 CellChangeTimes->{{3.895671710584262*^9, 3.895671765341384*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"b28bdbbf-9e84-4f0f-9cc9-412f8abccedb"],

Cell[BoxData[{
 RowBox[{"Names", "[", 
  "\"\<FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`*\
\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Names", "[", "\"\<FernandoDuarte`LongRunRisk`*\>\"", 
  "]"}], "\[IndentingNewLine]", "covLongFilename"}], "Input",
 CellChangeTimes->{{3.895691492038136*^9, 3.89569150776652*^9}, {
   3.895692922089941*^9, 3.8956929223143463`*^9}, 3.8956935194574747`*^9, {
   3.906024759699616*^9, 3.906024775239727*^9}, {3.906024825682197*^9, 
   3.906024829496788*^9}, {3.906024942614283*^9, 3.906024948730846*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"6fdd5095-1718-4546-b971-15bac0990051"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"uncondVar", "[", 
    RowBox[{
     RowBox[{"dc", "[", "t", "]"}], ",", "model"}], "]"}], "//.", 
   RowBox[{"model", "[", "\"\<assignParam\>\"", "]"}]}], "//", 
  "Simplify"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uncondVarLong", "[", 
   RowBox[{
    RowBox[{
    "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dc", "[", "t", 
     "]"}], ",", "FernandoDuarte`LongRunRisk`covLongNRCStochVol"}], "]"}], "//",
   "Simplify"}]}], "Input",
 CellChangeTimes->{{3.895681084223485*^9, 3.895681085981093*^9}, {
   3.895691347853261*^9, 3.89569135153448*^9}, {3.895691393456112*^9, 
   3.895691557981415*^9}, {3.8956928538194237`*^9, 3.895692866173498*^9}, 
   3.895692904036853*^9, {3.8956929767617188`*^9, 3.8956930366662407`*^9}, {
   3.895693540943253*^9, 3.895693581211513*^9}, 3.906024655348971*^9, 
   3.906024857296117*^9, {3.9060249329951982`*^9, 3.906024933403981*^9}, {
   3.9087030229570007`*^9, 3.90870302627277*^9}, 
   3.908711178557103*^9},ExpressionUUID->"e035627d-f7f6-4f0b-b74f-\
a562c8336cab"],

Cell[BoxData[
 RowBox[{"uncondCovLong", "[", 
  RowBox[{
   RowBox[{"FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`pi", "[", 
    RowBox[{"t", "+", "1"}], "]"}], ",", 
   RowBox[{"FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`pi", "[", 
    RowBox[{"t", "+", "2"}], "]"}], ",", 
   "FernandoDuarte`LongRunRisk`covLongNRCStochVol"}], "]"}]], "Input",
 CellChangeTimes->{{3.895693624889648*^9, 3.8956936314662848`*^9}, {
   3.895693677949348*^9, 3.895693707543398*^9}, {3.895693747177739*^9, 
   3.895693769474771*^9}, {3.895693805413787*^9, 3.895693806478087*^9}, 
   3.895694543015942*^9, 3.906024660328706*^9, 3.906024962663438*^9, {
   3.908703037554131*^9, 3.908703039703692*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"b0a7a7d7-6e01-463e-bb68-03ecfc5cd6c0"],

Cell[BoxData[
 RowBox[{"DownValues", "@", 
  "FernandoDuarte`LongRunRisk`covLongNRCStochVol"}]], "Input",
 CellChangeTimes->{{3.9060250787664547`*^9, 3.906025081075729*^9}, 
   3.90870304739532*^9},ExpressionUUID->"9cf15058-ec48-42d7-9d7e-\
194fb49443a3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pis", "=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dc", "[", 
      RowBox[{"t", "+", "j"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "0", ",", "12"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uncondVar", "[", "pis", "]"}], "//.", 
  RowBox[{"model", "[", "\"\<params\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Timing", "[", 
   RowBox[{"uncondVarLong", "[", 
    RowBox[{"pis", ",", "FernandoDuarte`LongRunRisk`covLongNRCStochVol"}], 
    "]"}], "]"}], "//.", 
  RowBox[{"model", "[", "\"\<params\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Timing", "[", 
   RowBox[{"uncondVar", "[", "pis", "]"}], "]"}], "//.", 
  RowBox[{"model", "[", "\"\<params\>\"", "]"}]}]}], "Input",
 CellChangeTimes->{{3.895693827932209*^9, 3.895693832084416*^9}, {
   3.8956945289940653`*^9, 3.895694669720798*^9}, {3.8956947225724277`*^9, 
   3.8956947471111307`*^9}, {3.8956957997459593`*^9, 3.895695812541032*^9}, 
   3.906024667809842*^9, {3.906024969324863*^9, 3.9060249961375427`*^9}, {
   3.906025027738143*^9, 3.906025042032774*^9}, {3.9060255245116796`*^9, 
   3.906025544820736*^9}, 3.908703051706497*^9},
 CellLabel->"In[41]:=",ExpressionUUID->"d4271660-79d6-4a2b-8f75-9d299046b6e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"uncondVarLong", "[", 
   RowBox[{"pis", ",", "FernandoDuarte`LongRunRisk`covLongNRCStochVol"}], 
   "]"}], ";"}]], "Input",
 CellChangeTimes->{3.908705286670685*^9},
 CellLabel->"In[45]:=",ExpressionUUID->"05954610-62ad-419e-bc13-63d2427ff19e"],

Cell[BoxData[{
 RowBox[{"Get", "[", "\"\<FernandoDuarte`LongRunRisk`\>\"", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Names", "[", "\"\<FernandoDuarte`LongRunRisk`*\>\"", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.895671834152318*^9, 3.895671863323642*^9}, {
  3.8956719043936567`*^9, 3.895671929033133*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"ec170e6e-3cfc-4d72-98f6-a53ddb03fec0"],

Cell[BoxData[
 RowBox[{"uncondCovLong", "[", 
  RowBox[{
   RowBox[{"dc", "[", "t", "]"}], ",", 
   RowBox[{"wc", "[", "t", "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.895671710584262*^9, 3.895671776840255*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"ba4bd127-e349-4d5a-9d76-82ba632deefb"],

Cell[BoxData[
 RowBox[{"uncondCovLong", "[", 
  RowBox[{
   RowBox[{"FernandoDuarte`LongRunRisk`dc", "[", "t", "]"}], ",", 
   RowBox[{"wc", "[", "t", "]"}], ",", 
   "FernandoDuarte`LongRunRisk`ComputationalEngine`CreateMomentsDatabase`\
Private`covLong"}], "]"}]], "Input",
 CellChangeTimes->{{3.8956723416620827`*^9, 3.895672342100902*^9}, {
  3.895681124420908*^9, 3.895681124591964*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"e5d99f81-f1c1-4728-8921-4e9ce80e78bc"],

Cell[BoxData[
 RowBox[{"uncondCovLong", "[", 
  RowBox[{
   RowBox[{
   "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dc", "[", "t", "]"}],
    ",", 
   RowBox[{
   "FernandoDuarte`LongRunRisk`Model`ExogenousEq`Private`dc", "[", "t", 
    "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.895670559787594*^9, 3.895670614155601*^9}, 
   3.895671390802264*^9, {3.895681133260745*^9, 3.89568116511982*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"c48e6a3a-36ab-4126-8120-47b9b05e0bf5"],

Cell[BoxData[
 RowBox[{"uncondCovLong", "[", 
  RowBox[{
   RowBox[{"retc", "[", "t", "]"}], ",", 
   RowBox[{"wc", "[", "t", "]"}]}], "]"}]], "Input",
 CellChangeTimes->{3.895672368474263*^9},
 CellLabel->"In[51]:=",ExpressionUUID->"ff1dfa66-5872-4078-9774-d4aa40f7fca5"],

Cell[BoxData[
 RowBox[{"uncondCovLong", "[", 
  RowBox[{
   RowBox[{"newvar", "[", 
    RowBox[{"t", ",", "m"}], "]"}], ",", 
   RowBox[{"wc", "[", "t", "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.895672531890614*^9, 3.895672556731016*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"83ffc50e-9817-40cb-a285-a67e2e7ec6a8"],

Cell[BoxData[
 RowBox[{"uncondCov", "[", 
  RowBox[{
   RowBox[{"wc", "[", "t", "]"}], ",", 
   RowBox[{"wc", "[", "t", "]"}], ",", "model"}], "]"}]], "Input",
 CellChangeTimes->{{3.895670176989801*^9, 3.895670179529163*^9}, {
  3.89567023773011*^9, 3.895670307978655*^9}, {3.895672599319847*^9, 
  3.895672604532843*^9}, {3.8956726712426434`*^9, 3.895672690919224*^9}, {
  3.9087062112994347`*^9, 3.908706213615621*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"cc9ac178-06f9-4e51-9ff1-d63e640447f9"]
}, Open  ]]
},
WindowSize->{1211, 942},
WindowMargins->{{Automatic, 91}, {Automatic, 0}},
WindowStatusArea->"",
TaggingRules-><|"TryRealOnly" -> False|>,
Magnification:>1.25 Inherited,
FrontEndVersion->"13.3 for Mac OS X ARM (64-bit) (July 24, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"28726991-7989-40ff-90db-b85d56c7a0a9"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[400, 13, 801, 16, 116, "Input",ExpressionUUID->"dc40f7be-969b-473a-9eef-1c4242fca6f8"],
Cell[1204, 31, 1541, 41, 142, "Input",ExpressionUUID->"a4362e4c-3422-4c94-ab26-d50864964ce4"],
Cell[2748, 74, 2384, 47, 142, "Input",ExpressionUUID->"3678a217-ed8d-42c6-86a2-75c1ea1115fd"],
Cell[CellGroupData[{
Cell[5157, 125, 257, 4, 67, "Subsection",ExpressionUUID->"d03dfeba-2718-41c7-9b3f-19ce5bed64e2"],
Cell[5417, 131, 595, 16, 64, "Input",ExpressionUUID->"4ed5f578-352d-450a-80c3-862d7bf99a10"],
Cell[6015, 149, 1947, 39, 402, "Input",ExpressionUUID->"5ea9f70b-0b8c-459e-9ee8-7dc6c6672ae0"],
Cell[7965, 190, 1374, 30, 402, "Input",ExpressionUUID->"fa946b96-4c46-453b-9b83-aba8a5e92fb0"],
Cell[9342, 222, 366, 9, 64, "Input",ExpressionUUID->"61669275-a1f5-4d34-958c-9291cd439be9"],
Cell[9711, 233, 262, 7, 37, "Input",ExpressionUUID->"56dedefd-27bf-4f07-9d08-49c2fa5e8972"],
Cell[9976, 242, 250, 6, 37, "Input",ExpressionUUID->"e14e5b59-e33d-44d7-813b-11c902dee319"],
Cell[10229, 250, 277, 7, 37, "Input",ExpressionUUID->"fefa24fc-c058-41d1-b49c-bb6e9a2999ce"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10543, 262, 210, 4, 67, "Subsection",ExpressionUUID->"6b918d18-7704-45dd-b222-55d8d234ce9f"],
Cell[10756, 268, 214, 4, 37, "Input",ExpressionUUID->"456aea83-3b17-4426-af60-5b58a2a0573c"],
Cell[10973, 274, 1086, 30, 168, "Input",ExpressionUUID->"1cb52e22-209f-41eb-978c-5c7f5d404f1b"],
Cell[12062, 306, 978, 18, 90, "Input",ExpressionUUID->"61d39cc5-b370-402a-9f30-d3392e6deb46"],
Cell[13043, 326, 918, 26, 90, "Input",ExpressionUUID->"47632f64-5dee-462c-9f21-f5a3d49e3d8e"],
Cell[13964, 354, 2214, 46, 168, "Input",ExpressionUUID->"30f23af8-6038-4069-8243-a8e8072685a3"],
Cell[16181, 402, 2542, 60, 298, "Input",ExpressionUUID->"2888b875-28ee-4f08-b551-05df1c125f41"],
Cell[18726, 464, 312, 5, 64, "Input",ExpressionUUID->"b28bdbbf-9e84-4f0f-9cc9-412f8abccedb"],
Cell[19041, 471, 647, 10, 90, "Input",ExpressionUUID->"6fdd5095-1718-4546-b971-15bac0990051"],
Cell[19691, 483, 1069, 23, 90, "Input",ExpressionUUID->"e035627d-f7f6-4f0b-b74f-a562c8336cab"],
Cell[20763, 508, 776, 13, 64, "Input",ExpressionUUID->"b0a7a7d7-6e01-463e-bb68-03ecfc5cd6c0"],
Cell[21542, 523, 255, 5, 37, "Input",ExpressionUUID->"9cf15058-ec48-42d7-9d7e-194fb49443a3"],
Cell[21800, 530, 1354, 29, 116, "Input",ExpressionUUID->"d4271660-79d6-4a2b-8f75-9d299046b6e8"],
Cell[23157, 561, 279, 6, 37, "Input",ExpressionUUID->"05954610-62ad-419e-bc13-63d2427ff19e"],
Cell[23439, 569, 388, 7, 64, "Input",ExpressionUUID->"ec170e6e-3cfc-4d72-98f6-a53ddb03fec0"],
Cell[23830, 578, 294, 6, 37, "Input",ExpressionUUID->"ba4bd127-e349-4d5a-9d76-82ba632deefb"],
Cell[24127, 586, 471, 9, 64, "Input",ExpressionUUID->"e5d99f81-f1c1-4728-8921-4e9ce80e78bc"],
Cell[24601, 597, 488, 11, 64, "Input",ExpressionUUID->"c48e6a3a-36ab-4126-8120-47b9b05e0bf5"],
Cell[25092, 610, 272, 6, 37, "Input",ExpressionUUID->"ff1dfa66-5872-4078-9774-d4aa40f7fca5"],
Cell[25367, 618, 323, 7, 37, "Input",ExpressionUUID->"83ffc50e-9817-40cb-a285-a67e2e7ec6a8"],
Cell[25693, 627, 500, 9, 37, "Input",ExpressionUUID->"cc9ac178-06f9-4e51-9ff1-d63e640447f9"]
}, Open  ]]
}
]
*)

