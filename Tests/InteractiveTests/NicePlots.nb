(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* Created By: SaveReadableNotebook *)
(* https://resources.wolframcloud.com/FunctionRepository/resources/SaveReadableNotebook *)

Notebook[
 {
  Cell[
   BoxData[
    RowBox[
     {
      "SetOptions",
      "[",
      RowBox[
       {
        "$FrontEnd",
        ",",
        " ",
        RowBox[
         {
          "\"ClearEvaluationQueueOnKernelQuit\"",
          " ",
          "->",
          " ",
          "False"
         }
        ]
       }
      ],
      "]"
     }
    ]
   ],
   "Input"
  ],
  Cell[
   CellGroupData[
    {
     Cell["NicePlots", "Section"],
     Cell[
      BoxData[RowBox[{RowBox[{"Quit", "[", "]"}], ";"}]],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "testName",
           " ",
           "=",
           " ",
           RowBox[
            {
             "First",
             "@",
             RowBox[
              {
               "NotebookRead",
               "[",
               RowBox[
                {
                 "PreviousCell",
                 "[",
                 RowBox[{"CellStyle", " ", "->", " ", "\"Section\""}],
                 "]"
                }
               ],
               "]"
              }
             ]
            }
           ]
          }
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "testFileName",
            "=",
            RowBox[
             {
              "FileNameJoin",
              "[",
              RowBox[
               {
                "{",
                RowBox[
                 {
                  RowBox[
                   {
                    "DirectoryName",
                    "[",
                    RowBox[{RowBox[{"NotebookDirectory", "[", "]"}], ",", "1"}],
                    "]"
                   }
                  ],
                  ",",
                  RowBox[{"testName", "<>", "\".wlt\""}]
                 }
                ],
                "}"
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "pacletDir",
            "=",
            RowBox[
             {
              "DirectoryName",
              "[",
              RowBox[{"testFileName", ",", "2"}],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "testContextBase",
            "=",
            RowBox[{"FileBaseName", "[", "testFileName", "]"}]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "$ContextPath",
            "=",
            RowBox[
             {
              "Cases",
              "[",
              RowBox[
               {
                "$ContextPath",
                ",",
                RowBox[
                 {"Except", "[", "\"PacletizedResourceFunctions`\"", "]"}
                ]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {"Needs", "[", "\"FernandoDuarte`LongRunRisk`\"", "]"}
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {"model", "=", RowBox[{"Models", "[", "\"NRC\"", "]"}]}
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[{RowBox[{"momF", " ", "=", "UncondE"}], ";"}],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "var",
            " ",
            "=",
            " ",
            RowBox[{"nombondyield", "[", RowBox[{"t", ",", "m"}], "]"}]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[{RowBox[{"maxMaturity", "=", "24"}], ";"}],
        "\[IndentingNewLine]",
        RowBox[{"varF", "=", RowBox[{"momF", "@", "var"}]}]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "solWc",
           "=",
           RowBox[
            {
             "FernandoDuarte`LongRunRisk`ComputationalEngine`SolveEulerEq`updateCoeffs",
             "[",
             RowBox[
              {"model", ",", RowBox[{"\"UpdatePd\"", "->", "True"}]}
             ],
             "]"
            }
           ]
          }
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {"ToNum", "[", RowBox[{"\"Rules\"", ",", "model"}], "]"}
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "ToNum",
           "[",
           RowBox[
            {
             "\"Rules\"",
             ",",
             "model",
             ",",
             RowBox[{"\"MaxMaturity\"", "->", "1"}]
            }
           ],
           "]"
          }
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "ReleaseHold",
         "@",
         RowBox[
          {
           "If",
           "[",
           RowBox[
            {
             RowBox[
              {
               "KeyExistsQ",
               "[",
               RowBox[
                {
                 RowBox[{"model", "[", "\"extraInfo\"", "]"}],
                 ",",
                 "\"initialGuess\""
                }
               ],
               "]"
              }
             ],
             ",",
             RowBox[
              {
               "\"initialGuess\"",
               "->",
               RowBox[
                {
                 RowBox[{"model", "[", "\"extraInfo\"", "]"}],
                 "[",
                 "\"initialGuess\"",
                 "]"
                }
               ]
              }
             ],
             ",",
             RowBox[{"Hold", "@", RowBox[{"Sequence", "[", "]"}]}]
            }
           ],
           " ",
           "]"
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "FernandoDuarte`LongRunRisk`Tools`ToNumber`Private`toNumRules",
         "[",
         RowBox[
          {
           "model",
           ",",
           RowBox[{"\"MaxMaturity\"", "->", "1"}],
           ",",
           RowBox[{"{", "}"}]
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "FernandoDuarte`LongRunRisk`Tools`ToNumber`Private`toNumRules",
         "[",
         RowBox[
          {
           "model",
           ",",
           RowBox[{"\"MaxMaturity\"", "->", "1"}],
           ",",
           RowBox[{"{", "}"}],
           " ",
           ",",
           RowBox[
            {
             "\"initialGuess\"",
             "\[Rule]",
             RowBox[
              {
               "\[LeftAssociation]",
               RowBox[
                {
                 RowBox[{"\"Ewc\"", "\[Rule]", RowBox[{"{", "4.6`", "}"}]}],
                 ",",
                 RowBox[
                  {
                   "\"Epd\"",
                   "\[Rule]",
                   RowBox[
                    {
                     "{",
                     RowBox[
                      {
                       RowBox[{"{", RowBox[{"0", ",", "15"}], "}"}],
                       ",",
                       RowBox[{"{", RowBox[{"0", ",", "15"}], "}"}],
                       ",",
                       RowBox[{"{", "5.5", "}"}]
                      }
                     ],
                     "}"
                    }
                   ]
                  }
                 ]
                }
               ],
               "\[RightAssociation]"
              }
             ]
            }
           ]
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "dataF",
         "=",
         RowBox[
          {
           RowBox[
            {
             "Table",
             "[",
             RowBox[
              {
               RowBox[
                {
                 RowBox[{"{", RowBox[{"m", ",", "varF"}], "}"}],
                 "/.",
                 RowBox[{"m", "->", "mm"}]
                }
               ],
               ",",
               RowBox[{"{", RowBox[{"mm", ",", "maxMaturity"}], "}"}]
              }
             ],
             "]"
            }
           ],
           "//",
           RowBox[
            {
             "ToNum",
             "[",
             RowBox[
              {
               "model",
               ",",
               RowBox[{"{", "}"}],
               ",",
               "solWc",
               ",",
               RowBox[{"\"MaxMaturity\"", "->", "24"}],
               ",",
               RowBox[{"\"UpdateBonds\"", "->", "True"}]
              }
             ],
             "]"
            }
           ]
          }
         ]
        }
       ]
      ],
      "Input"
     ],
     Cell[BoxData["Dynamic"], "Input"],
     Cell[
      BoxData[RowBox[{"ListLinePlot", "[", "dataF", "]"}]],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "paramNumRange",
           "=",
           RowBox[
            {
             "\[LeftAssociation]",
             "\[IndentingNewLine]",
             "\t",
             RowBox[
              {
               RowBox[
                {
                 "alpha",
                 "\[Rule]",
                 RowBox[
                  {"{", RowBox[{"0.005", ",", "0.15", ",", "0.01"}], "}"}
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "tau",
                 "\[Rule]",
                 RowBox[{"{", RowBox[{"0.1", ",", "4", ",", "0.05"}], "}"}]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "beta",
                 "\[Rule]",
                 RowBox[
                  {"{", RowBox[{"0.001", ",", "0.1", ",", "0.005"}], "}"}
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "av",
                 "\[Rule]",
                 RowBox[
                  {"{", RowBox[{"0.01", ",", "0.15", ",", "0.01"}], "}"}
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "gamma",
                 "\[Rule]",
                 RowBox[{"{", RowBox[{"1", ",", "10", ",", "0.5"}], "}"}]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "kappa",
                 "\[Rule]",
                 RowBox[{"{", RowBox[{"0.1", ",", "2", ",", "0.1"}], "}"}]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "muG",
                 "\[Rule]",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "1"}], ",", "1", ",", "0.1"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "kappaG",
                 "\[Rule]",
                 RowBox[{"{", RowBox[{"0.01", ",", "2", ",", "0.1"}], "}"}]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "sigmaG",
                 "\[Rule]",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "0.3"}], ",", "0.3", ",", "0.001"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "X0",
                 "\[Rule]",
                 RowBox[{"{", RowBox[{"1", ",", "10000", ",", "250"}], "}"}]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "g0",
                 "\[Rule]",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "5"}], ",", "5", ",", "0.2"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "z0",
                 "\[Rule]",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "5"}], ",", "5", ",", "1"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "varepsilon",
                 "\[Rule]",
                 RowBox[{"{", RowBox[{"1", ",", "3", ",", "0.25"}], "}"}]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "phi0",
                 "\[Rule]",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "0.1"}], ",", "0.5", ",", "0.005"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "phig",
                 "\[Rule]",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "0.2"}], ",", "0.2", ",", "0.005"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "phiz",
                 "\[Rule]",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "0.2"}], ",", "0.2", ",", "0.005"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "gmin",
                 "->",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "2"}], ",", "2", ",", "0.1"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "gmax",
                 "->",
                 RowBox[
                  {
                   "{",
                   RowBox[{RowBox[{"-", "2"}], ",", "6", ",", "0.1"}],
                   "}"
                  }
                 ]
                }
               ],
               ",",
               "\[IndentingNewLine]",
               "\t",
               RowBox[
                {
                 "T",
                 "->",
                 RowBox[{"{", RowBox[{"1", ",", "5", ",", "1"}], "}"}]
                }
               ]
              }
             ],
             "\[IndentingNewLine]",
             "\[RightAssociation]"
            }
           ]
          }
         ],
         ";"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       {
        RowBox[
         {
          RowBox[
           {
            "toParamRange",
            "=",
            RowBox[
             {
              "Map",
              "[",
              RowBox[
               {
                RowBox[
                 {
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {
                      RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}],
                      ",",
                      RowBox[{"#", "[", RowBox[{"[", "2", "]"}], "]"}],
                      ",",
                      FractionBox[
                       RowBox[
                        {
                         RowBox[{"#", "[", RowBox[{"[", "2", "]"}], "]"}],
                         "-",
                         RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}]
                        }
                       ],
                       "20"
                      ]
                     }
                    ],
                    "}"
                   }
                  ],
                  "&"
                 }
                ],
                ",",
                RowBox[
                 {
                  "Flatten",
                  "/@",
                  RowBox[
                   {
                    "(",
                    RowBox[
                     {
                      RowBox[
                       {
                        "(",
                        RowBox[
                         {
                          "N",
                          "@",
                          RowBox[
                           {
                            "(",
                            RowBox[
                             {
                              RowBox[{"toParam", "//.", "toParam"}],
                              "/.",
                              RowBox[
                               {
                                "Map",
                                "[",
                                RowBox[
                                 {
                                  RowBox[
                                   {
                                    RowBox[{"Interval", "@", RowBox[{"Most", "@", "#"}]}],
                                    "&"
                                   }
                                  ],
                                  ",",
                                  "paramNumRange"
                                 }
                                ],
                                "]"
                               }
                              ]
                             }
                            ],
                            ")"
                           }
                          ]
                         }
                        ],
                        ")"
                       }
                      ],
                      "/.",
                      RowBox[
                       {
                        RowBox[{"Interval", "[", "x_", "]"}],
                        "->",
                        RowBox[{"List", "[", "x", "]"}]
                       }
                      ]
                     }
                    ],
                    ")"
                   }
                  ]
                 }
                ]
               }
              ],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "paramRange",
              "=",
              RowBox[
               {
                "Join",
                "[",
                RowBox[{"paramNumRange", ",", "toParamRange"}],
                "]"
               }
              ]
             }
            ],
            ";"
           }
          ],
          "\[IndentingNewLine]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "paramDyn",
            "=",
            RowBox[
             {
              "{",
              RowBox[
               {
                "phig",
                ",",
                "phi0",
                ",",
                "muG",
                ",",
                "sigmaG",
                ",",
                "kappaG",
                ",",
                "alpha",
                ",",
                "tau",
                ",",
                "beta",
                ",",
                "av",
                ",",
                "gmin",
                ",",
                "gmax"
               }
              ],
              "}"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\n",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "paramDynAssoc",
              "=",
              RowBox[
               {
                "param",
                "[",
                RowBox[
                 {
                  "[",
                  RowBox[
                   {
                    RowBox[{RowBox[{"Key", "[", "#", "]"}], "&"}],
                    "/@",
                    "paramDyn"
                   }
                  ],
                  "]"
                 }
                ],
                "]"
               }
              ]
             }
            ],
            ";"
           }
          ],
          "\[IndentingNewLine]",
          "\[IndentingNewLine]",
          "\[IndentingNewLine]",
          "\[IndentingNewLine]",
          "\[IndentingNewLine]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "varNamesTeXAssoc",
            "=",
            RowBox[
             {
              "(",
              RowBox[
               {
                "Association",
                "@",
                RowBox[
                 {
                  "Thread",
                  "[",
                  RowBox[{"varNames", "->", "varNamesTeX"}],
                  "]"
                 }
                ]
               }
              ],
              ")"
             }
            ]
           }
          ],
          ";"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "irfControls",
              "=",
              RowBox[
               {
                "{",
                "\[IndentingNewLine]",
                RowBox[
                 {
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {
                      RowBox[
                       {
                        "{",
                        RowBox[
                         {"gminIRF", ",", RowBox[{"-", "0.5"}], ",", "\"gminIRF\""}
                        ],
                        "}"
                       }
                      ],
                      ",",
                      RowBox[{"-", "6"}],
                      ",",
                      "3",
                      ",",
                      "0.1`",
                      ",",
                      RowBox[
                       {
                        "Appearance",
                        "\[Rule]",
                        RowBox[{"{", RowBox[{"\"Open\"", ",", "Small"}], "}"}]
                       }
                      ]
                     }
                    ],
                    "}"
                   }
                  ],
                  ",",
                  "\[IndentingNewLine]",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {
                      RowBox[
                       {
                        "{",
                        RowBox[{"gmaxIRF", ",", "0.12", ",", "\"gmaxIRF\""}],
                        "}"
                       }
                      ],
                      ",",
                      RowBox[{"-", "3"}],
                      ",",
                      "6",
                      ",",
                      "0.1`",
                      ",",
                      RowBox[
                       {
                        "Appearance",
                        "\[Rule]",
                        RowBox[{"{", RowBox[{"\"Open\"", ",", "Small"}], "}"}]
                       }
                      ]
                     }
                    ],
                    "}"
                   }
                  ],
                  ",",
                  "\[IndentingNewLine]",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {
                      RowBox[
                       {
                        "{",
                        RowBox[
                         {"g0min", ",", RowBox[{"-", "0.15"}], ",", "\"g0minIRF\""}
                        ],
                        "}"
                       }
                      ],
                      ",",
                      RowBox[{"-", "6"}],
                      ",",
                      "6",
                      ",",
                      "0.1`",
                      ",",
                      RowBox[
                       {
                        "Appearance",
                        "\[Rule]",
                        RowBox[{"{", RowBox[{"\"Open\"", ",", "Small"}], "}"}]
                       }
                      ]
                     }
                    ],
                    "}"
                   }
                  ],
                  ",",
                  "\[IndentingNewLine]",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {
                      RowBox[
                       {
                        "{",
                        RowBox[{"g0med", ",", "0.09", ",", "\"g0medIRF\""}],
                        "}"
                       }
                      ],
                      ",",
                      RowBox[{"-", "6"}],
                      ",",
                      "6",
                      ",",
                      "0.1`",
                      ",",
                      RowBox[
                       {
                        "Appearance",
                        "\[Rule]",
                        RowBox[{"{", RowBox[{"\"Open\"", ",", "Small"}], "}"}]
                       }
                      ]
                     }
                    ],
                    "}"
                   }
                  ],
                  ",",
                  "\[IndentingNewLine]",
                  RowBox[
                   {
                    "{",
                    RowBox[
                     {
                      RowBox[
                       {
                        "{",
                        RowBox[{"g0max", ",", "0.11", ",", "\"g0maxIRF\""}],
                        "}"
                       }
                      ],
                      ",",
                      RowBox[{"-", "6"}],
                      ",",
                      "6",
                      ",",
                      "0.1`",
                      ",",
                      RowBox[
                       {
                        "Appearance",
                        "\[Rule]",
                        RowBox[{"{", RowBox[{"\"Open\"", ",", "Small"}], "}"}]
                       }
                      ]
                     }
                    ],
                    "}"
                   }
                  ]
                 }
                ],
                "\[IndentingNewLine]",
                "}"
               }
              ]
             }
            ],
            ";"
           }
          ],
          "\[IndentingNewLine]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            RowBox[
             {
              "paramStatControls",
              "=",
              RowBox[
               {
                "KeyValueMap",
                "[",
                RowBox[
                 {
                  RowBox[
                   {
                    RowBox[
                     {
                      "{",
                      RowBox[
                       {
                        RowBox[
                         {
                          "{",
                          RowBox[
                           {
                            RowBox[
                             {
                              "ToExpression",
                              "[",
                              RowBox[
                               {RowBox[{"ToString", "[", "#1", "]"}], "<>", "\"M\""}
                              ],
                              "]"
                             }
                            ],
                            ",",
                            "#2",
                            ",",
                            RowBox[{"ToString", "[", "#1", "]"}]
                           }
                          ],
                          "}"
                         }
                        ],
                        ",",
                        RowBox[
                         {
                          RowBox[{"paramRange", "[", "#1", "]"}],
                          "/.",
                          RowBox[{"List", "->", "Sequence"}]
                         }
                        ],
                        ",",
                        RowBox[
                         {
                          "Appearance",
                          " ",
                          "\[Rule]",
                          " ",
                          RowBox[{"{", RowBox[{"\"Open\"", ",", "Small"}], "}"}]
                         }
                        ]
                       }
                      ],
                      "}"
                     }
                    ],
                    "&"
                   }
                  ],
                  ",",
                  "paramDynAssoc"
                 }
                ],
                "]"
               }
              ]
             }
            ],
            ";"
           }
          ],
          "\[IndentingNewLine]"
         }
        ],
        "\[IndentingNewLine]",
        RowBox[
         {
          RowBox[
           {
            "parControls",
            "=",
            RowBox[
             {
              "Join",
              "[",
              RowBox[{"paramStatControls", ",", "irfControls"}],
              "]"
             }
            ]
           }
          ],
          ";"
         }
        ]
       }
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         "SetOptions",
         "[",
         RowBox[
          {
           "$FrontEnd",
           ",",
           " ",
           RowBox[
            {
             "\"ClearEvaluationQueueOnKernelQuit\"",
             " ",
             "->",
             " ",
             "True"
            }
           ]
          }
         ],
         "]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      BoxData[
       RowBox[
        {
         RowBox[
          {
           "Manipulate",
           "[",
           "\[IndentingNewLine]",
           "\[IndentingNewLine]",
           RowBox[
            {
             ",",
             "\[IndentingNewLine]",
             "\[IndentingNewLine]",
             RowBox[
              {
               "Evaluate",
               "[",
               RowBox[{"Sequence", "@@", "parControls"}],
               "]"
              }
             ],
             "\[IndentingNewLine]",
             ",",
             "\[IndentingNewLine]",
             RowBox[{"ContinuousAction", "->", "None"}]
            }
           ],
           "\[IndentingNewLine]",
           "]"
          }
         ],
         "\[IndentingNewLine]"
        }
       ]
      ],
      "Input"
     ],
     Cell[
      CellGroupData[
       {
        Cell[
         BoxData[RowBox[{RowBox[{"Quit", "[", "]"}], ";"}]],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ],
        Cell[
         BoxData[
          RowBox[
           {
            RowBox[
             {
              "testName",
              " ",
              "=",
              " ",
              RowBox[
               {
                "First",
                "@",
                RowBox[
                 {
                  "NotebookRead",
                  "[",
                  RowBox[
                   {
                    "PreviousCell",
                    "[",
                    RowBox[{"CellStyle", " ", "->", " ", "\"Section\""}],
                    "]"
                   }
                  ],
                  "]"
                 }
                ]
               }
              ]
             }
            ],
            ";"
           }
          ]
         ],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ],
        Cell[
         BoxData[
          {
           RowBox[
            {
             RowBox[
              {
               "testFileName",
               "=",
               RowBox[
                {
                 "FileNameJoin",
                 "[",
                 RowBox[
                  {
                   "{",
                   RowBox[
                    {
                     RowBox[
                      {
                       "DirectoryName",
                       "[",
                       RowBox[{RowBox[{"NotebookDirectory", "[", "]"}], ",", "1"}],
                       "]"
                      }
                     ],
                     ",",
                     RowBox[{"testName", "<>", "\".wlt\""}]
                    }
                   ],
                   "}"
                  }
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "pacletDir",
               "=",
               RowBox[
                {
                 "DirectoryName",
                 "[",
                 RowBox[{"testFileName", ",", "2"}],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[{"PacletDirectoryLoad", "[", "pacletDir", "]"}],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "testContextBase",
               "=",
               RowBox[{"FileBaseName", "[", "testFileName", "]"}]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "$ContextPath",
               "=",
               RowBox[
                {
                 "Cases",
                 "[",
                 RowBox[
                  {
                   "$ContextPath",
                   ",",
                   RowBox[
                    {"Except", "[", "\"PacletizedResourceFunctions`\"", "]"}
                   ]
                  }
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "resourcesDir",
               "=",
               RowBox[
                {
                 "FileNameJoin",
                 "[",
                 RowBox[
                  {"{", RowBox[{"pacletDir", ",", "\"Resources\""}], "}"}
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "Get",
               "@",
               RowBox[
                {
                 "Get",
                 "[",
                 RowBox[
                  {
                   "FileNameJoin",
                   "[",
                   RowBox[
                    {"{", RowBox[{"resourcesDir", ",", "\"Models.wl\""}], "}"}
                   ],
                   "]"
                  }
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]"
          }
         ],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ],
        Cell[
         BoxData[
          {
           RowBox[
            {
             "Needs",
             "[",
             "\"FernandoDuarte`LongRunRisk`Tools`ToNumber`\"",
             "]"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             "Needs",
             "[",
             "\"FernandoDuarte`LongRunRisk`Tools`NicePlots`\"",
             "]"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "(*",
               RowBox[
                {"Needs", "[", "\"FernandoDuarte`LongRunRisk`\"", "]"}
               ],
               "*)"
              }
             ]
            }
           ]
          }
         ],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ],
        Cell[
         BoxData[
          RowBox[
           {
            RowBox[
             {
              "myModel",
              "=",
              RowBox[
               {
                "FernandoDuarte`LongRunRisk`Models",
                "[",
                "\"NRCStochVol\"",
                "]"
               }
              ]
             }
            ],
            ";"
           }
          ]
         ],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ],
        Cell[
         BoxData[
          {
           RowBox[
            {
             RowBox[
              {
               "newparams",
               "=",
               RowBox[
                {
                 "{",
                 RowBox[
                  {
                   RowBox[{"delta", "\[Rule]", "0.999"}],
                   ",",
                   RowBox[{"Esg", "\[Rule]", "0.000062`"}],
                   ",",
                   RowBox[{"Esp", "\[Rule]", "0.01`"}],
                   ",",
                   RowBox[{"gamma", "\[Rule]", "15`"}],
                   ",",
                   RowBox[{"muc", "\[Rule]", "0.0016`"}],
                   ",",
                   RowBox[{"mup", "\[Rule]", "0.0033`"}],
                   ",",
                   RowBox[{"mupbar", "\[Rule]", "0.0033`"}],
                   ",",
                   RowBox[{"phic", "\[Rule]", "0.0021`"}],
                   ",",
                   RowBox[{"phicp", "\[Rule]", "0.002`"}],
                   ",",
                   RowBox[{"phig", "\[Rule]", "0.0029`"}],
                   ",",
                   RowBox[{"phip", "\[Rule]", RowBox[{"-", "0.0025`"}]}],
                   ",",
                   RowBox[{"phipbarpb", "\[Rule]", "1.1`"}],
                   ",",
                   RowBox[{"phispw", "\[Rule]", "1.81`*^-7"}],
                   ",",
                   RowBox[{"psi", "\[Rule]", "1.5"}],
                   ",",
                   RowBox[{"rhocp", "\[Rule]", "0.2`"}],
                   ",",
                   RowBox[{"rhog", "\[Rule]", "0.998`"}],
                   ",",
                   RowBox[{"rhopbar", "\[Rule]", "0.9"}],
                   ",",
                   RowBox[{"rhoppbar", "\[Rule]", "1"}],
                   ",",
                   RowBox[{"vp", "\[Rule]", "0.9795`"}],
                   ",",
                   RowBox[
                    {
                     "vpp",
                     "\[Rule]",
                     RowBox[{"-", FractionBox["7", "100000"]}]
                    }
                   ],
                   ",",
                   RowBox[{"vppbar", "\[Rule]", FractionBox["7", "1000000"]}],
                   ",",
                   RowBox[{"xic", "\[Rule]", RowBox[{"-", "0.198`"}]}],
                   ",",
                   RowBox[{"xip", "\[Rule]", "0.00073"}],
                   ",",
                   RowBox[
                    {RowBox[{"mud", "[", "1", "]"}], "\[Rule]", "0.0016`"}
                   ],
                   ",",
                   RowBox[
                    {RowBox[{"phidc", "[", "1", "]"}], "\[Rule]", "0.0021`"}
                   ],
                   ",",
                   RowBox[
                    {RowBox[{"phidp", "[", "1", "]"}], "\[Rule]", "0.002`"}
                   ],
                   ",",
                   RowBox[
                    {RowBox[{"rhodp", "[", "1", "]"}], "\[Rule]", "0.2`"}
                   ],
                   ",",
                   RowBox[
                    {
                     RowBox[{"xid", "[", "1", "]"}],
                     "\[Rule]",
                     RowBox[{"-", "0.198`"}]
                    }
                   ]
                  }
                 ],
                 "}"
                }
               ]
              }
             ],
             ";"
            }
           ],
           "\[IndentingNewLine]",
           RowBox[
            {
             RowBox[
              {
               "solNew",
               "=",
               " ",
               RowBox[
                {
                 "toNum",
                 "[",
                 RowBox[
                  {
                   "\"Rules\"",
                   ",",
                   " ",
                   "myModel",
                   ",",
                   "newparams",
                   ",",
                   RowBox[{"{", "}"}]
                  }
                 ],
                 "]"
                }
               ]
              }
             ],
             ";"
            }
           ]
          }
         ],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ],
        Cell[
         BoxData[
          RowBox[
           {
            "solWcNew",
            "=",
            RowBox[
             {
              "FilterRules",
              "[",
              RowBox[
               {
                "solNew",
                ",",
                RowBox[
                 {
                  "FernandoDuarte`LongRunRisk`Model`EndogenousEq`Private`A",
                  "[",
                  "_",
                  "]"
                 }
                ]
               }
              ],
              "]"
             }
            ]
           }
          ]
         ],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ],
        Cell[
         BoxData[
          RowBox[
           {
            RowBox[
             {
              "(*",
              RowBox[
               {
                "FindRoot",
                " ",
                "plot",
                " ",
                "to",
                " ",
                "find",
                " ",
                RowBox[{"A", "[", "0", "]"}]
               }
              ],
              "*)"
             }
            ],
            "\[IndentingNewLine]",
            RowBox[
             {
              RowBox[
               {
                RowBox[
                 {
                  "Echo",
                  "[",
                  RowBox[
                   {
                    RowBox[
                     {
                      RowBox[
                       {
                        "FernandoDuarte`LongRunRisk`Model`EndogenousEq`Private`A",
                        "[",
                        "0",
                        "]"
                       }
                      ],
                      "/.",
                      "solWcNew"
                     }
                    ],
                    ",",
                    "\"A[0]\""
                   }
                  ],
                  "]"
                 }
                ],
                ";"
               }
              ],
              "\[IndentingNewLine]",
              RowBox[
               {
                RowBox[
                 {
                  "plotNew",
                  "=",
                  RowBox[
                   {
                    "plotCoeffs",
                    "[",
                    RowBox[
                     {
                      "myModel",
                      ",",
                      "solWcNew",
                      ",",
                      "newparams",
                      ",",
                      RowBox[{"{", "2", "}"}],
                      ",",
                      " ",
                      RowBox[{"PlotLegends", "->", "Automatic"}]
                     }
                    ],
                    "]"
                   }
                  ]
                 }
                ],
                ";"
               }
              ],
              "\[IndentingNewLine]",
              RowBox[
               {
                "Show",
                "[",
                RowBox[
                 {
                  "Plot",
                  "@@",
                  RowBox[
                   {
                    "(",
                    RowBox[
                     {
                      "Rest",
                      "@",
                      RowBox[
                       {
                        "Append",
                        "[",
                        RowBox[
                         {
                          "plotNew",
                          ",",
                          RowBox[
                           {"PlotLabel", "->", "\"Equation to solve for A[0]\""}
                          ]
                         }
                        ],
                        "]"
                       }
                      ]
                     }
                    ],
                    ")"
                   }
                  ]
                 }
                ],
                "]"
               }
              ],
              "\[IndentingNewLine]",
              RowBox[
               {
                "Show",
                "[",
                RowBox[
                 {
                  RowBox[{"First", "@", "plotNew"}],
                  ",",
                  " ",
                  RowBox[{"PlotLabel", "->", "\"FindRoot steps\""}]
                 }
                ],
                "]"
               }
              ]
             }
            ]
           }
          ]
         ],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ],
        Cell[
         BoxData[""],
         "Input",
         CellGroupingRules -> {"GroupTogetherGrouping", 10000.0}
        ]
       },
       Open
      ]
     ]
    },
    Open
   ]
  ]
 },
 WindowSize -> {1078, 842},
 WindowMargins -> {{-1458, Automatic}, {15, Automatic}},
 FrontEndVersion -> "13.3 for Mac OS X ARM (64-bit) (July 24, 2023)",
 StyleDefinitions -> "Default.nb",
 ExpressionUUID -> "bee789da-a308-4742-a404-9a5f3cddb73e"
]